var da=Object.defineProperty;var ua=(y,c,z)=>c in y?da(y,c,{enumerable:!0,configurable:!0,writable:!0,value:z}):y[c]=z;var F=(y,c,z)=>(ua(y,typeof c!="symbol"?c+"":c,z),z),xt=(y,c,z)=>{if(!c.has(y))throw TypeError("Cannot "+z)};var E=(y,c,z)=>(xt(y,c,"read from private field"),z?z.call(y):c.get(y)),ie=(y,c,z)=>{if(c.has(y))throw TypeError("Cannot add the same private member more than once");c instanceof WeakSet?c.add(y):c.set(y,z)},we=(y,c,z,he)=>(xt(y,c,"write to private field"),he?he.call(y,z):c.set(y,z),z);(function(y,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],c):(y=typeof globalThis<"u"?globalThis:y||self,c(y.VcutMedia={},y.React))})(this,function(y,c){var Q,oe,ae,le,ce,je,K;"use strict";var z=typeof document<"u"?document.currentScript:null,he={exports:{}},ye={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var We;function yt(){if(We)return ye;We=1;var r=c,t=Symbol.for("react.element"),e=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,f={key:!0,ref:!0,__self:!0,__source:!0};function p(l,h,m){var b,T={},w=null,j=null;m!==void 0&&(w=""+m),h.key!==void 0&&(w=""+h.key),h.ref!==void 0&&(j=h.ref);for(b in h)n.call(h,b)&&!f.hasOwnProperty(b)&&(T[b]=h[b]);if(l&&l.defaultProps)for(b in h=l.defaultProps,h)T[b]===void 0&&(T[b]=h[b]);return{$$typeof:t,type:l,key:w,ref:j,props:T,_owner:s.current}}return ye.Fragment=e,ye.jsx=p,ye.jsxs=p,ye}var ve={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ve;function vt(){return Ve||(Ve=1,process.env.NODE_ENV!=="production"&&function(){var r=c,t=Symbol.for("react.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),l=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),b=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),j=Symbol.for("react.offscreen"),C=Symbol.iterator,U="@@iterator";function q(a){if(a===null||typeof a!="object")return null;var i=C&&a[C]||a[U];return typeof i=="function"?i:null}var M=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function A(a){{for(var i=arguments.length,d=new Array(i>1?i-1:0),x=1;x<i;x++)d[x-1]=arguments[x];de("error",a,d)}}function de(a,i,d){{var x=M.ReactDebugCurrentFrame,k=x.getStackAddendum();k!==""&&(i+="%s",d=d.concat([k]));var P=d.map(function(O){return String(O)});P.unshift("Warning: "+i),Function.prototype.apply.call(console[a],console,P)}}var ue=!1,fe=!1,S=!1,R=!1,u=!1,v;v=Symbol.for("react.module.reference");function L(a){return!!(typeof a=="string"||typeof a=="function"||a===n||a===f||u||a===s||a===m||a===b||R||a===j||ue||fe||S||typeof a=="object"&&a!==null&&(a.$$typeof===w||a.$$typeof===T||a.$$typeof===p||a.$$typeof===l||a.$$typeof===h||a.$$typeof===v||a.getModuleId!==void 0))}function Y(a,i,d){var x=a.displayName;if(x)return x;var k=i.displayName||i.name||"";return k!==""?d+"("+k+")":d}function se(a){return a.displayName||"Context"}function J(a){if(a==null)return null;if(typeof a.tag=="number"&&A("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case n:return"Fragment";case e:return"Portal";case f:return"Profiler";case s:return"StrictMode";case m:return"Suspense";case b:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case l:var i=a;return se(i)+".Consumer";case p:var d=a;return se(d._context)+".Provider";case h:return Y(a,a.render,"ForwardRef");case T:var x=a.displayName||null;return x!==null?x:J(a.type)||"Memo";case w:{var k=a,P=k._payload,O=k._init;try{return J(O(P))}catch{return null}}}return null}var te=Object.assign,D=0,W,X,G,re,ge,et,tt;function at(){}at.__reactDisabledLog=!0;function Ut(){{if(D===0){W=console.log,X=console.info,G=console.warn,re=console.error,ge=console.group,et=console.groupCollapsed,tt=console.groupEnd;var a={configurable:!0,enumerable:!0,value:at,writable:!0};Object.defineProperties(console,{info:a,log:a,warn:a,error:a,group:a,groupCollapsed:a,groupEnd:a})}D++}}function Ft(){{if(D--,D===0){var a={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:te({},a,{value:W}),info:te({},a,{value:X}),warn:te({},a,{value:G}),error:te({},a,{value:re}),group:te({},a,{value:ge}),groupCollapsed:te({},a,{value:et}),groupEnd:te({},a,{value:tt})})}D<0&&A("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var _e=M.ReactCurrentDispatcher,Me;function Se(a,i,d){{if(Me===void 0)try{throw Error()}catch(k){var x=k.stack.trim().match(/\n( *(at )?)/);Me=x&&x[1]||""}return`
`+Me+a}}var Le=!1,Ie;{var Nt=typeof WeakMap=="function"?WeakMap:Map;Ie=new Nt}function rt(a,i){if(!a||Le)return"";{var d=Ie.get(a);if(d!==void 0)return d}var x;Le=!0;var k=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var P;P=_e.current,_e.current=null,Ut();try{if(i){var O=function(){throw Error()};if(Object.defineProperty(O.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(O,[])}catch(Z){x=Z}Reflect.construct(a,[],O)}else{try{O.call()}catch(Z){x=Z}a.call(O.prototype)}}else{try{throw Error()}catch(Z){x=Z}a()}}catch(Z){if(Z&&x&&typeof Z.stack=="string"){for(var I=Z.stack.split(`
`),H=x.stack.split(`
`),N=I.length-1,B=H.length-1;N>=1&&B>=0&&I[N]!==H[B];)B--;for(;N>=1&&B>=0;N--,B--)if(I[N]!==H[B]){if(N!==1||B!==1)do if(N--,B--,B<0||I[N]!==H[B]){var $=`
`+I[N].replace(" at new "," at ");return a.displayName&&$.includes("<anonymous>")&&($=$.replace("<anonymous>",a.displayName)),typeof a=="function"&&Ie.set(a,$),$}while(N>=1&&B>=0);break}}}finally{Le=!1,_e.current=P,Ft(),Error.prepareStackTrace=k}var xe=a?a.displayName||a.name:"",pe=xe?Se(xe):"";return typeof a=="function"&&Ie.set(a,pe),pe}function zt(a,i,d){return rt(a,!1)}function Bt(a){var i=a.prototype;return!!(i&&i.isReactComponent)}function Te(a,i,d){if(a==null)return"";if(typeof a=="function")return rt(a,Bt(a));if(typeof a=="string")return Se(a);switch(a){case m:return Se("Suspense");case b:return Se("SuspenseList")}if(typeof a=="object")switch(a.$$typeof){case h:return zt(a.render);case T:return Te(a.type,i,d);case w:{var x=a,k=x._payload,P=x._init;try{return Te(P(k),i,d)}catch{}}}return""}var be=Object.prototype.hasOwnProperty,nt={},ot=M.ReactDebugCurrentFrame;function Ce(a){if(a){var i=a._owner,d=Te(a.type,a._source,i?i.type:null);ot.setExtraStackFrame(d)}else ot.setExtraStackFrame(null)}function Wt(a,i,d,x,k){{var P=Function.call.bind(be);for(var O in a)if(P(a,O)){var I=void 0;try{if(typeof a[O]!="function"){var H=Error((x||"React class")+": "+d+" type `"+O+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof a[O]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw H.name="Invariant Violation",H}I=a[O](i,O,x,d,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(N){I=N}I&&!(I instanceof Error)&&(Ce(k),A("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",x||"React class",d,O,typeof I),Ce(null)),I instanceof Error&&!(I.message in nt)&&(nt[I.message]=!0,Ce(k),A("Failed %s type: %s",d,I.message),Ce(null))}}}var Vt=Array.isArray;function Pe(a){return Vt(a)}function Gt(a){{var i=typeof Symbol=="function"&&Symbol.toStringTag,d=i&&a[Symbol.toStringTag]||a.constructor.name||"Object";return d}}function Yt(a){try{return st(a),!1}catch{return!0}}function st(a){return""+a}function it(a){if(Yt(a))return A("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Gt(a)),st(a)}var Ee=M.ReactCurrentOwner,Kt={key:!0,ref:!0,__self:!0,__source:!0},lt,ct,Ue;Ue={};function Jt(a){if(be.call(a,"ref")){var i=Object.getOwnPropertyDescriptor(a,"ref").get;if(i&&i.isReactWarning)return!1}return a.ref!==void 0}function Xt(a){if(be.call(a,"key")){var i=Object.getOwnPropertyDescriptor(a,"key").get;if(i&&i.isReactWarning)return!1}return a.key!==void 0}function Ht(a,i){if(typeof a.ref=="string"&&Ee.current&&i&&Ee.current.stateNode!==i){var d=J(Ee.current.type);Ue[d]||(A('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',J(Ee.current.type),a.ref),Ue[d]=!0)}}function Zt(a,i){{var d=function(){lt||(lt=!0,A("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",i))};d.isReactWarning=!0,Object.defineProperty(a,"key",{get:d,configurable:!0})}}function Qt(a,i){{var d=function(){ct||(ct=!0,A("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",i))};d.isReactWarning=!0,Object.defineProperty(a,"ref",{get:d,configurable:!0})}}var qt=function(a,i,d,x,k,P,O){var I={$$typeof:t,type:a,key:i,ref:d,props:O,_owner:P};return I._store={},Object.defineProperty(I._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(I,"_self",{configurable:!1,enumerable:!1,writable:!1,value:x}),Object.defineProperty(I,"_source",{configurable:!1,enumerable:!1,writable:!1,value:k}),Object.freeze&&(Object.freeze(I.props),Object.freeze(I)),I};function $t(a,i,d,x,k){{var P,O={},I=null,H=null;d!==void 0&&(it(d),I=""+d),Xt(i)&&(it(i.key),I=""+i.key),Jt(i)&&(H=i.ref,Ht(i,k));for(P in i)be.call(i,P)&&!Kt.hasOwnProperty(P)&&(O[P]=i[P]);if(a&&a.defaultProps){var N=a.defaultProps;for(P in N)O[P]===void 0&&(O[P]=N[P])}if(I||H){var B=typeof a=="function"?a.displayName||a.name||"Unknown":a;I&&Zt(O,B),H&&Qt(O,B)}return qt(a,I,H,k,x,Ee.current,O)}}var Fe=M.ReactCurrentOwner,dt=M.ReactDebugCurrentFrame;function me(a){if(a){var i=a._owner,d=Te(a.type,a._source,i?i.type:null);dt.setExtraStackFrame(d)}else dt.setExtraStackFrame(null)}var Ne;Ne=!1;function ze(a){return typeof a=="object"&&a!==null&&a.$$typeof===t}function ut(){{if(Fe.current){var a=J(Fe.current.type);if(a)return`

Check the render method of \``+a+"`."}return""}}function ea(a){{if(a!==void 0){var i=a.fileName.replace(/^.*[\\\/]/,""),d=a.lineNumber;return`

Check your code at `+i+":"+d+"."}return""}}var ft={};function ta(a){{var i=ut();if(!i){var d=typeof a=="string"?a:a.displayName||a.name;d&&(i=`

Check the top-level render call using <`+d+">.")}return i}}function pt(a,i){{if(!a._store||a._store.validated||a.key!=null)return;a._store.validated=!0;var d=ta(i);if(ft[d])return;ft[d]=!0;var x="";a&&a._owner&&a._owner!==Fe.current&&(x=" It was passed a child from "+J(a._owner.type)+"."),me(a),A('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',d,x),me(null)}}function ht(a,i){{if(typeof a!="object")return;if(Pe(a))for(var d=0;d<a.length;d++){var x=a[d];ze(x)&&pt(x,i)}else if(ze(a))a._store&&(a._store.validated=!0);else if(a){var k=q(a);if(typeof k=="function"&&k!==a.entries)for(var P=k.call(a),O;!(O=P.next()).done;)ze(O.value)&&pt(O.value,i)}}}function aa(a){{var i=a.type;if(i==null||typeof i=="string")return;var d;if(typeof i=="function")d=i.propTypes;else if(typeof i=="object"&&(i.$$typeof===h||i.$$typeof===T))d=i.propTypes;else return;if(d){var x=J(i);Wt(d,a.props,"prop",x,a)}else if(i.PropTypes!==void 0&&!Ne){Ne=!0;var k=J(i);A("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",k||"Unknown")}typeof i.getDefaultProps=="function"&&!i.getDefaultProps.isReactClassApproved&&A("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function ra(a){{for(var i=Object.keys(a.props),d=0;d<i.length;d++){var x=i[d];if(x!=="children"&&x!=="key"){me(a),A("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",x),me(null);break}}a.ref!==null&&(me(a),A("Invalid attribute `ref` supplied to `React.Fragment`."),me(null))}}var gt={};function mt(a,i,d,x,k,P){{var O=L(a);if(!O){var I="";(a===void 0||typeof a=="object"&&a!==null&&Object.keys(a).length===0)&&(I+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var H=ea(k);H?I+=H:I+=ut();var N;a===null?N="null":Pe(a)?N="array":a!==void 0&&a.$$typeof===t?(N="<"+(J(a.type)||"Unknown")+" />",I=" Did you accidentally export a JSX literal instead of a component?"):N=typeof a,A("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",N,I)}var B=$t(a,i,d,k,P);if(B==null)return B;if(O){var $=i.children;if($!==void 0)if(x)if(Pe($)){for(var xe=0;xe<$.length;xe++)ht($[xe],a);Object.freeze&&Object.freeze($)}else A("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ht($,a)}if(be.call(i,"key")){var pe=J(a),Z=Object.keys(i).filter(function(ca){return ca!=="key"}),Be=Z.length>0?"{key: someKey, "+Z.join(": ..., ")+": ...}":"{key: someKey}";if(!gt[pe+Be]){var la=Z.length>0?"{"+Z.join(": ..., ")+": ...}":"{}";A(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Be,pe,la,pe),gt[pe+Be]=!0}}return a===n?ra(B):aa(B),B}}function na(a,i,d){return mt(a,i,d,!0)}function oa(a,i,d){return mt(a,i,d,!1)}var sa=oa,ia=na;ve.Fragment=n,ve.jsx=sa,ve.jsxs=ia}()),ve}process.env.NODE_ENV==="production"?he.exports=yt():he.exports=vt();var o=he.exports;let Re;const bt=new Uint8Array(16);function Et(){if(!Re&&(Re=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Re))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Re(bt)}const V=[];for(let r=0;r<256;++r)V.push((r+256).toString(16).slice(1));function wt(r,t=0){return V[r[t+0]]+V[r[t+1]]+V[r[t+2]]+V[r[t+3]]+"-"+V[r[t+4]]+V[r[t+5]]+"-"+V[r[t+6]]+V[r[t+7]]+"-"+V[r[t+8]]+V[r[t+9]]+"-"+V[r[t+10]]+V[r[t+11]]+V[r[t+12]]+V[r[t+13]]+V[r[t+14]]+V[r[t+15]]}const Ge={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ye(r,t,e){if(Ge.randomUUID&&!t&&!r)return Ge.randomUUID();r=r||{};const n=r.random||(r.rng||Et)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){e=e||0;for(let s=0;s<16;++s)t[e+s]=n[s];return t}return wt(n)}var _;(function(r){r.LOAD="LOAD",r.EXEC="EXEC",r.FFPROBE="FFPROBE",r.WRITE_FILE="WRITE_FILE",r.READ_FILE="READ_FILE",r.DELETE_FILE="DELETE_FILE",r.RENAME="RENAME",r.CREATE_DIR="CREATE_DIR",r.LIST_DIR="LIST_DIR",r.DELETE_DIR="DELETE_DIR",r.ERROR="ERROR",r.DOWNLOAD="DOWNLOAD",r.PROGRESS="PROGRESS",r.LOG="LOG",r.MOUNT="MOUNT",r.UNMOUNT="UNMOUNT"})(_||(_={}));const Rt=(()=>{let r=0;return()=>r++})(),jt=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),St=new Error("called FFmpeg.terminate()");class It{constructor(){ie(this,Q,null);ie(this,oe,{});ie(this,ae,{});ie(this,le,[]);ie(this,ce,[]);F(this,"loaded",!1);ie(this,je,()=>{E(this,Q)&&(E(this,Q).onmessage=({data:{id:t,type:e,data:n}})=>{switch(e){case _.LOAD:this.loaded=!0,E(this,oe)[t](n);break;case _.MOUNT:case _.UNMOUNT:case _.EXEC:case _.FFPROBE:case _.WRITE_FILE:case _.READ_FILE:case _.DELETE_FILE:case _.RENAME:case _.CREATE_DIR:case _.LIST_DIR:case _.DELETE_DIR:E(this,oe)[t](n);break;case _.LOG:E(this,le).forEach(s=>s(n));break;case _.PROGRESS:E(this,ce).forEach(s=>s(n));break;case _.ERROR:E(this,ae)[t](n);break}delete E(this,oe)[t],delete E(this,ae)[t]})});ie(this,K,({type:t,data:e},n=[],s)=>E(this,Q)?new Promise((f,p)=>{const l=Rt();E(this,Q)&&E(this,Q).postMessage({id:l,type:t,data:e},n),E(this,oe)[l]=f,E(this,ae)[l]=p,s==null||s.addEventListener("abort",()=>{p(new DOMException(`Message # ${l} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(jt));F(this,"load",({classWorkerURL:t,...e}={},{signal:n}={})=>(E(this,Q)||(we(this,Q,t?new Worker(new URL(t,typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:z&&z.tagName.toUpperCase()==="SCRIPT"&&z.src||new URL("index.umd.js",document.baseURI).href),{type:"module"}):new Worker(new URL("/assets/worker-1c8189a2.js",self.location),{type:"module"})),E(this,je).call(this)),E(this,K).call(this,{type:_.LOAD,data:e},void 0,n)));F(this,"exec",(t,e=-1,{signal:n}={})=>E(this,K).call(this,{type:_.EXEC,data:{args:t,timeout:e}},void 0,n));F(this,"ffprobe",(t,e=-1,{signal:n}={})=>E(this,K).call(this,{type:_.FFPROBE,data:{args:t,timeout:e}},void 0,n));F(this,"terminate",()=>{const t=Object.keys(E(this,ae));for(const e of t)E(this,ae)[e](St),delete E(this,ae)[e],delete E(this,oe)[e];E(this,Q)&&(E(this,Q).terminate(),we(this,Q,null),this.loaded=!1)});F(this,"writeFile",(t,e,{signal:n}={})=>{const s=[];return e instanceof Uint8Array&&s.push(e.buffer),E(this,K).call(this,{type:_.WRITE_FILE,data:{path:t,data:e}},s,n)});F(this,"mount",(t,e,n)=>{const s=[];return E(this,K).call(this,{type:_.MOUNT,data:{fsType:t,options:e,mountPoint:n}},s)});F(this,"unmount",t=>{const e=[];return E(this,K).call(this,{type:_.UNMOUNT,data:{mountPoint:t}},e)});F(this,"readFile",(t,e="binary",{signal:n}={})=>E(this,K).call(this,{type:_.READ_FILE,data:{path:t,encoding:e}},void 0,n));F(this,"deleteFile",(t,{signal:e}={})=>E(this,K).call(this,{type:_.DELETE_FILE,data:{path:t}},void 0,e));F(this,"rename",(t,e,{signal:n}={})=>E(this,K).call(this,{type:_.RENAME,data:{oldPath:t,newPath:e}},void 0,n));F(this,"createDir",(t,{signal:e}={})=>E(this,K).call(this,{type:_.CREATE_DIR,data:{path:t}},void 0,e));F(this,"listDir",(t,{signal:e}={})=>E(this,K).call(this,{type:_.LIST_DIR,data:{path:t}},void 0,e));F(this,"deleteDir",(t,{signal:e}={})=>E(this,K).call(this,{type:_.DELETE_DIR,data:{path:t}},void 0,e))}on(t,e){t==="log"?E(this,le).push(e):t==="progress"&&E(this,ce).push(e)}off(t,e){t==="log"?we(this,le,E(this,le).filter(n=>n!==e)):t==="progress"&&we(this,ce,E(this,ce).filter(n=>n!==e))}}Q=new WeakMap,oe=new WeakMap,ae=new WeakMap,le=new WeakMap,ce=new WeakMap,je=new WeakMap,K=new WeakMap;var Ke;(function(r){r.MEMFS="MEMFS",r.NODEFS="NODEFS",r.NODERAWFS="NODERAWFS",r.IDBFS="IDBFS",r.WORKERFS="WORKERFS",r.PROXYFS="PROXYFS"})(Ke||(Ke={}));const Tt=r=>new Promise((t,e)=>{const n=new FileReader;n.onload=()=>{const{result:s}=n;s instanceof ArrayBuffer?t(new Uint8Array(s)):t(new Uint8Array)},n.onerror=s=>{var f,p;e(Error(`File could not be read! Code=${((p=(f=s==null?void 0:s.target)==null?void 0:f.error)==null?void 0:p.code)||-1}`))},n.readAsArrayBuffer(r)}),Je=async r=>{let t;if(typeof r=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(r)?t=atob(r.split(",")[1]).split("").map(e=>e.charCodeAt(0)):t=await(await fetch(r)).arrayBuffer();else if(r instanceof URL)t=await(await fetch(r)).arrayBuffer();else if(r instanceof File||r instanceof Blob)t=await Tt(r);else return new Uint8Array;return new Uint8Array(t)};var g=(r=>(r.VIDEO="video",r.AUDIO="audio",r.IMAGE="image",r))(g||{});class Ct{constructor(){F(this,"ffmpeg",null);F(this,"loaded",!1);F(this,"loading",!1);F(this,"logs","");F(this,"loadAttempts",0);F(this,"maxLoadAttempts",3);F(this,"loadPromise",null)}async load(){if(!this.loaded){if(this.loading&&this.loadPromise)return this.loadPromise;if(this.loadAttempts>=this.maxLoadAttempts){console.warn(`FFmpeg Î°úÎìú ÏµúÎåÄ ÏãúÎèÑ ÌöüÏàò(${this.maxLoadAttempts}Ìöå) Ï¥àÍ≥º, ÎåÄÏ≤¥ Î∞©Î≤ïÏúºÎ°ú Ï†ÑÌôò`),this.loaded=!0;return}return this.loading=!0,this.loadAttempts++,console.log(`FFmpeg Î°úÎìú ÏãúÎèÑ ${this.loadAttempts}/${this.maxLoadAttempts}`),this.ffmpeg=new It,this.ffmpeg.on("log",({message:t})=>{this.logs+=t+`
`,console.log("FFmpeg Î°úÍ∑∏:",t)}),this.loadPromise=(async()=>{try{console.log("FFmpeg Î°úÎìú ÏãúÏûë v1.5"),typeof SharedArrayBuffer>"u"?console.warn("SharedArrayBufferÍ∞Ä ÏßÄÏõêÎêòÏßÄ ÏïäÏäµÎãàÎã§. COOP/COEP ÏÑ§Ï†ïÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî."):console.log("SharedArrayBuffer ÏßÄÏõêÎê®");const t=window.location.origin;if(this.ffmpeg)await this.ffmpeg.load({coreURL:`${t}/ffmpeg/ffmpeg-core.js`,wasmURL:`${t}/ffmpeg/ffmpeg-core.wasm`,workerURL:`${t}/ffmpeg/ffmpeg-core.worker.js`});else throw new Error("FFmpeg Ïù∏Ïä§ÌÑ¥Ïä§Í∞Ä nullÏûÖÎãàÎã§.");this.loaded=!0,this.loadAttempts=0,console.log("FFmpeg Î°úÎìú ÏôÑÎ£å (Î°úÏª¨ ÌååÏùº)")}catch(t){console.error("FFmpeg Î°úÎìú Ïã§Ìå® (Î°úÏª¨ ÌååÏùº):",t),this.loadAttempts>=this.maxLoadAttempts?(console.warn("FFmpeg Î°úÎìú Ïã§Ìå®, ÎåÄÏ≤¥ Î∞©Î≤ïÏúºÎ°ú Ï†ÑÌôò"),this.loaded=!0,this.loadAttempts=0):(console.log("FFmpeg Î°úÎìú Ïû¨ÏãúÎèÑ..."),await new Promise(e=>setTimeout(e,1e3)),this.loading=!1,await this.load())}finally{this.loading=!1}})(),this.loadPromise}}async extractMetadata(t){await this.ensureLoaded();try{if(this.logs="",console.log(`ÌååÏùº Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú ÏãúÏûë: ${t.name}, ÌÅ¨Í∏∞: ${t.size}Î∞îÏù¥Ìä∏`),!this.ffmpeg)return console.warn("FFmpegÎ•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏñ¥ Í∏∞Î≥∏ Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Î∞òÌôò"),this.createBasicMetadata(t);await this.ffmpeg.writeFile("input",await Je(t)),console.log("ÌååÏùº ÏóÖÎ°úÎìú ÏôÑÎ£å");const e=this.detectMediaType(t.name);console.log(`Í∞êÏßÄÎêú ÎØ∏ÎîîÏñ¥ ÌÉÄÏûÖ: ${e}`),console.log("Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú Î™ÖÎ†π Ïã§Ìñâ"),await this.ffmpeg.exec(["-i","input","-f","null","-"]);const n={width:0,height:0,duration:this.extractDuration(this.logs),bitRate:this.extractBitrate(this.logs),codec:this.extractCodec(this.logs,e)};if(e===g.VIDEO||e===g.IMAGE){const s=this.extractResolution(this.logs);n.width=s.width,n.height=s.height}return e===g.AUDIO&&(n.channels=this.extractAudioChannels(this.logs),n.sampleRate=this.extractSampleRate(this.logs)),console.log("Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú ÏôÑÎ£å:",n),n}catch(e){return console.error("Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú Ïã§Ìå®:",e),this.createBasicMetadata(t)}finally{this.ffmpeg&&await this.ffmpeg.deleteFile("input").catch(e=>{console.error("ÏûÑÏãú ÌååÏùº ÏÇ≠Ï†ú Ïã§Ìå®:",e)})}}createBasicMetadata(t){const e=this.detectMediaType(t.name);return console.log(`Í∏∞Î≥∏ Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± (ÌÉÄÏûÖ: ${e})`),e===g.AUDIO&&typeof window<"u"&&window.AudioContext?new Promise(n=>{try{const s=new AudioContext,f=new FileReader;f.onload=p=>{var h;const l=(h=p.target)==null?void 0:h.result;s.decodeAudioData(l,m=>{n({width:0,height:0,duration:m.duration,bitRate:Math.round(t.size*8/m.duration/1e3),codec:"mp3",channels:m.numberOfChannels,sampleRate:m.sampleRate})},m=>{console.error("Ïò§ÎîîÏò§ ÎîîÏΩîÎî© Ïã§Ìå®:",m),n(this.createFallbackMetadata(t,e))})},f.onerror=()=>{n(this.createFallbackMetadata(t,e))},f.readAsArrayBuffer(t)}catch(s){console.error("Web Audio API ÏÇ¨Ïö© Ïã§Ìå®:",s),n(this.createFallbackMetadata(t,e))}}):this.createFallbackMetadata(t,e)}createFallbackMetadata(t,e){let n=0;return e===g.AUDIO?n=t.size*8/(128*1024):e===g.VIDEO&&(n=t.size*8/(1024*1024)),{width:e===g.IMAGE||e===g.VIDEO?640:0,height:e===g.IMAGE||e===g.VIDEO?480:0,duration:n,bitRate:e===g.AUDIO?128:0,codec:e===g.AUDIO?"mp3":"unknown",channels:e===g.AUDIO?2:void 0,sampleRate:e===g.AUDIO?44100:void 0}}async generateThumbnail(t,e,n={}){await this.ensureLoaded();const{width:s=320,height:f=180,quality:p=90,time:l=0}=n;if(console.log(`Ïç∏ÎÑ§Ïùº ÏÉùÏÑ± ÏãúÏûë: ${t.name}, ÌÉÄÏûÖ: ${e}`),!this.ffmpeg)return console.warn("FFmpegÎ•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏñ¥ Canvas Í∏∞Î∞ò Ïç∏ÎÑ§Ïùº ÏÉùÏÑ±"),this.createCanvasThumbnail(t,e,s,f,p);try{if(await this.ffmpeg.writeFile("input",await Je(t)),console.log("Ïç∏ÎÑ§ÏùºÏö© ÌååÏùº ÏóÖÎ°úÎìú ÏôÑÎ£å"),e===g.VIDEO)console.log(`ÎπÑÎîîÏò§ Ïç∏ÎÑ§Ïùº Ï∂îÏ∂ú (ÏãúÍ∞Ñ: ${l}Ï¥à)`),await this.ffmpeg.exec(["-ss",l.toString(),"-i","input","-vframes","1","-q:v",Math.floor(p/10).toString(),"-vf",`scale=${s}:${f}:force_original_aspect_ratio=decrease`,"thumbnail.jpg"]);else if(e===g.IMAGE)console.log("Ïù¥ÎØ∏ÏßÄ Ïç∏ÎÑ§Ïùº ÏÉùÏÑ±"),await this.ffmpeg.exec(["-i","input","-q:v",Math.floor(p/10).toString(),"-vf",`scale=${s}:${f}:force_original_aspect_ratio=decrease`,"thumbnail.jpg"]);else if(e===g.AUDIO){console.log("Ïò§ÎîîÏò§ Ïç∏ÎÑ§Ïùº ÏÉùÏÑ±");try{console.log("Ïò§ÎîîÏò§ ÌååÌòï Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± ÏãúÎèÑ"),await this.ffmpeg.exec(["-i","input","-filter_complex","showwavespic=s=320x180:colors=#3498db","-frames:v","1","thumbnail.jpg"]),console.log("Ïò§ÎîîÏò§ ÌååÌòï Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± ÏÑ±Í≥µ")}catch(T){console.warn("Ïò§ÎîîÏò§ ÌååÌòï Ïç∏ÎÑ§Ïùº ÏÉùÏÑ± Ïã§Ìå®, Í∏∞Î≥∏ Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïö©:",T);try{await this.ffmpeg.exec(["-f","lavfi","-i","color=c=blue:s=320x180","-vf","drawtext=text='üéµ':fontsize=72:fontcolor=white:x=(w-text_w)/2:y=(h-text_h)/2","-frames:v","1","thumbnail.jpg"])}catch(w){console.error("Í∏∞Î≥∏ Ïò§ÎîîÏò§ Ïç∏ÎÑ§Ïùº ÏÉùÏÑ± Ïã§Ìå®:",w),await this.ffmpeg.exec(["-f","lavfi","-i","color=c=blue:s=320x180","-frames:v","1","thumbnail.jpg"])}}}console.log("Ïç∏ÎÑ§Ïùº ÌååÏùº ÏùΩÍ∏∞");const h=await this.ffmpeg.readFile("thumbnail.jpg"),m=new Blob([h],{type:"image/jpeg"}),b=URL.createObjectURL(m);return console.log("Ïç∏ÎÑ§Ïùº ÏÉùÏÑ± ÏôÑÎ£å"),b}catch(h){return console.error("Ïç∏ÎÑ§Ïùº ÏÉùÏÑ± Ïã§Ìå®:",h),this.createCanvasThumbnail(t,e,s,f,p)}finally{this.ffmpeg&&(await this.ffmpeg.deleteFile("input").catch(()=>{}),await this.ffmpeg.deleteFile("thumbnail.jpg").catch(()=>{}))}}createCanvasThumbnail(t,e,n,s,f){return new Promise(p=>{if(e===g.IMAGE&&typeof window<"u"){const l=new Image,h=URL.createObjectURL(t);l.onload=()=>{const m=document.createElement("canvas");m.width=n,m.height=s;const b=m.getContext("2d");b?(b.drawImage(l,0,0,n,s),URL.revokeObjectURL(h),p(m.toDataURL("image/jpeg",f/100))):(URL.revokeObjectURL(h),p(this.createDefaultThumbnail(t,e,n,s,f)))},l.onerror=()=>{URL.revokeObjectURL(h),p(this.createDefaultThumbnail(t,e,n,s,f))},l.src=h}else p(this.createDefaultThumbnail(t,e,n,s,f))})}createDefaultThumbnail(t,e,n,s,f){if(typeof document>"u")return"";const p=document.createElement("canvas");p.width=n,p.height=s;const l=p.getContext("2d");if(!l)return"";if(e===g.AUDIO){const h=l.createLinearGradient(0,0,0,s);h.addColorStop(0,"#3498db"),h.addColorStop(1,"#2980b9"),l.fillStyle=h,l.fillRect(0,0,n,s),l.strokeStyle="rgba(255, 255, 255, 0.5)",l.lineWidth=2,l.beginPath();const m=20,b=n/m;for(let T=0;T<=m;T++){const w=T*b,j=Math.random()*.5+.2,C=s/2+Math.sin(T*.5)*s*j*.5;T===0?l.moveTo(w,C):l.lineTo(w,C)}l.stroke(),l.fillStyle="#ffffff",l.font="bold 48px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText("üéµ",n/2,s/2),l.font="12px Arial",l.fillText(t.name.substring(0,20),n/2,s-20)}else if(e===g.VIDEO){const h=l.createLinearGradient(0,0,0,s);h.addColorStop(0,"#3949ab"),h.addColorStop(1,"#303f9f"),l.fillStyle=h,l.fillRect(0,0,n,s),l.fillStyle="#ffffff",l.font="bold 48px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText("üé¨",n/2,s/2),l.font="12px Arial",l.fillText(t.name.substring(0,20),n/2,s-20)}else l.fillStyle="#43a047",l.fillRect(0,0,n,s),l.fillStyle="#ffffff",l.font="bold 48px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText("üìÅ",n/2,s/2),l.font="12px Arial",l.fillText(t.name.substring(0,20),n/2,s-20);return p.toDataURL("image/jpeg",f/100)}async ensureLoaded(){if(!this.loaded){if(this.loading&&this.loadPromise)return this.loadPromise;try{await this.load()}catch(t){console.error("FFmpeg Î°úÎìú ÌôïÏù∏ Ï§ë Ïò§Î•ò:",t),this.loaded=!0}}}async terminate(){this.ffmpeg&&(await this.ffmpeg.terminate(),this.ffmpeg=null,this.loaded=!1)}detectMediaType(t){var p;const e=((p=t.split(".").pop())==null?void 0:p.toLowerCase())||"",n=["mp4","webm","ogg","mov","avi","wmv","flv","mkv"],s=["mp3","wav","ogg","aac","m4a","flac"],f=["jpg","jpeg","png","gif","webp","bmp","tiff"];return n.includes(e)?g.VIDEO:s.includes(e)?g.AUDIO:f.includes(e)?g.IMAGE:g.VIDEO}extractDuration(t){const e=t.match(/Duration: (\d{2}):(\d{2}):(\d{2})\.(\d{2})/);if(e){const n=parseInt(e[1]),s=parseInt(e[2]),f=parseInt(e[3]),p=parseInt(e[4]);return n*3600+s*60+f+p/100}return 0}extractBitrate(t){const e=t.match(/bitrate: (\d+) kb\/s/);return e?parseInt(e[1]):0}extractResolution(t){const e=t.match(/(\d{2,5})x(\d{2,5})/);return e?{width:parseInt(e[1]),height:parseInt(e[2])}:{width:0,height:0}}extractCodec(t,e){if(e===g.VIDEO){const n=t.match(/Video: ([^,]+)/);return n?n[1].trim():"unknown"}else if(e===g.AUDIO){const n=t.match(/Audio: ([^,]+)/);return n?n[1].trim():"unknown"}return"unknown"}extractAudioChannels(t){const e=t.match(/Audio: ([^,]+), (\d+) channels/);return e?parseInt(e[2]):0}extractSampleRate(t){const e=t.match(/Audio: ([^,]+), (\d+) Hz/);return e?parseInt(e[2]):0}}const ne=new Ct,Xe="vcut_media_items";class Dt{constructor(){F(this,"items",new Map);this.loadFromStorage()}loadFromStorage(){try{const t=localStorage.getItem(Xe);t&&(JSON.parse(t).forEach(n=>{n.createdAt=new Date(n.createdAt),n.importedAt=new Date(n.importedAt),this.items.set(n.id,n)}),console.log(`${this.items.size}Í∞úÏùò ÎØ∏ÎîîÏñ¥ Ìï≠Î™©ÏùÑ Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Î°úÎìúÌñàÏäµÎãàÎã§.`))}catch(t){console.error("Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú ÎØ∏ÎîîÏñ¥ Ìï≠Î™©ÏùÑ Î°úÎìúÌïòÎäî Ï§ë Ïò§Î•ò Î∞úÏÉù:",t)}}saveToStorage(){try{const t=Array.from(this.items.values());localStorage.setItem(Xe,JSON.stringify(t))}catch(t){console.error("ÎØ∏ÎîîÏñ¥ Ìï≠Î™©ÏùÑ Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•ÌïòÎäî Ï§ë Ïò§Î•ò Î∞úÏÉù:",t)}}async importMedia(t){const e=[];console.log(`ÌååÏùº ÏûÑÌè¨Ìä∏ ÏãúÏûë: ${t.length}Í∞ú`);for(const n of t)try{console.log(`ÌååÏùº ÏûÑÌè¨Ìä∏: ${n.name}`);const s=this.detectMediaType(n);console.log(`Í∞êÏßÄÎêú ÎØ∏ÎîîÏñ¥ ÌÉÄÏûÖ: ${s}`);const f=await ne.extractMetadata(n);console.log("ÎØ∏ÎîîÏñ¥ Ìï≠Î™© ÏÉùÏÑ± ÏãúÏûë");const p=await this.createMediaItem({name:n.name,type:s,path:URL.createObjectURL(n),size:n.size,metadata:f});console.log("ÎØ∏ÎîîÏñ¥ Ìï≠Î™© ÏÉùÏÑ± ÏôÑÎ£å");const l=await ne.generateThumbnail(n,s);p.thumbnail=l,console.log("Ïç∏ÎÑ§Ïùº ÏÉùÏÑ± ÏôÑÎ£å"),this.items.set(p.id,p),e.push(p)}catch(s){console.error(`ÌååÏùº ÏûÑÌè¨Ìä∏ Ïã§Ìå®: ${n.name}`,s)}return console.log("ÌååÏùº ÏûÑÌè¨Ìä∏ ÏôÑÎ£å"),this.saveToStorage(),e}async getMediaItems(t={}){let e=Array.from(this.items.values());if(t.type&&t.type.length>0&&(e=e.filter(n=>t.type.includes(n.type))),t.tags&&t.tags.length>0&&(e=e.filter(n=>t.tags.some(s=>n.tags.includes(s)))),t.favorite!==void 0&&(e=e.filter(n=>n.favorite===t.favorite)),t.search){const n=t.search.toLowerCase();e=e.filter(s=>s.name.toLowerCase().includes(n)||s.tags.some(f=>f.toLowerCase().includes(n)))}if(t.sortBy){const n=t.sortDirection==="desc"?-1:1;e.sort((s,f)=>{switch(t.sortBy){case"name":return n*s.name.localeCompare(f.name);case"size":return n*(s.size-f.size);case"createdAt":return n*(s.createdAt.getTime()-f.createdAt.getTime());case"importedAt":return n*(s.importedAt.getTime()-f.importedAt.getTime());case"duration":const p=s.metadata.duration||0,l=f.metadata.duration||0;return n*(p-l);default:return 0}})}return e}async getMediaById(t){return this.items.get(t)||null}async updateMedia(t,e){const n=this.items.get(t);if(!n)throw new Error(`ÎØ∏ÎîîÏñ¥ Ìï≠Î™©ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå: ${t}`);const s={...n,...e};return this.items.set(t,s),this.saveToStorage(),s}async deleteMedia(t){const e=this.items.get(t);e&&(URL.revokeObjectURL(e.url),e.thumbnail&&e.thumbnail.startsWith("blob:")&&URL.revokeObjectURL(e.thumbnail));const n=this.items.delete(t);return this.saveToStorage(),n}async generateThumbnail(t,e){try{const s=await(await fetch(t.url)).blob(),f=new File([s],t.name,{type:this.getMimeType(t.type)}),p=await ne.generateThumbnail(f,t.type,e);return t.thumbnail&&t.thumbnail.startsWith("blob:")&&URL.revokeObjectURL(t.thumbnail),t.thumbnail=p,this.items.set(t.id,t),this.saveToStorage(),p}catch(n){throw console.error("Ïç∏ÎÑ§Ïùº ÏÉùÏÑ± Ïã§Ìå®:",n),new Error("Ïç∏ÎÑ§ÏùºÏùÑ ÏÉùÏÑ±Ìï† Ïàò ÏóÜÏäµÎãàÎã§")}}async extractMetadata(t){return await ne.extractMetadata(t)}async createMediaItem(t){const e=new Date;return{id:Ye(),name:t.name,type:t.type,path:t.path,url:t.path,size:t.size,createdAt:e,importedAt:e,metadata:t.metadata||{},tags:t.tags||[],favorite:t.favorite||!1,thumbnail:""}}detectMediaType(t){var l;const e=t.type.toLowerCase();if(e.startsWith("video/"))return g.VIDEO;if(e.startsWith("audio/"))return g.AUDIO;if(e.startsWith("image/"))return g.IMAGE;const n=(l=t.name.split(".").pop())==null?void 0:l.toLowerCase(),s=["mp4","avi","mov","wmv","flv","mkv","webm"],f=["mp3","wav","ogg","aac","m4a","flac"],p=["jpg","jpeg","png","gif","bmp","webp","svg"];return n&&s.includes(n)?g.VIDEO:n&&f.includes(n)?g.AUDIO:n&&p.includes(n)?g.IMAGE:g.VIDEO}getMimeType(t){switch(t){case g.VIDEO:return"video/mp4";case g.AUDIO:return"audio/mp3";case g.IMAGE:return"image/jpeg";default:return"application/octet-stream"}}}const ee=new Dt,At={items:[],selectedItems:[],isLoading:!1,error:null,filter:{}};function Ot(r,t){switch(t.type){case"SET_ITEMS":return{...r,items:t.payload};case"ADD_ITEMS":return{...r,items:[...r.items,...t.payload]};case"UPDATE_ITEM":return{...r,items:r.items.map(e=>e.id===t.payload.id?t.payload:e)};case"REMOVE_ITEM":return{...r,items:r.items.filter(e=>e.id!==t.payload),selectedItems:r.selectedItems.filter(e=>e!==t.payload)};case"SELECT_ITEM":return{...r,selectedItems:[...r.selectedItems,t.payload]};case"DESELECT_ITEM":return{...r,selectedItems:r.selectedItems.filter(e=>e!==t.payload)};case"SELECT_ALL":return{...r,selectedItems:r.items.map(e=>e.id)};case"DESELECT_ALL":return{...r,selectedItems:[]};case"SET_FILTER":return{...r,filter:t.payload};case"SET_LOADING":return{...r,isLoading:t.payload};case"SET_ERROR":return{...r,error:t.payload};default:return r}}const He=c.createContext(void 0),kt=({children:r})=>{const[t,e]=c.useReducer(Ot,At),n=c.useCallback(async j=>{try{e({type:"SET_LOADING",payload:!0}),e({type:"SET_ERROR",payload:null});const C=await ee.importMedia(j);return e({type:"ADD_ITEMS",payload:C}),C}catch(C){return e({type:"SET_ERROR",payload:C}),[]}finally{e({type:"SET_LOADING",payload:!1})}},[]),s=c.useCallback(async j=>{try{e({type:"SET_LOADING",payload:!0}),e({type:"SET_ERROR",payload:null});const C=j||t.filter;j&&e({type:"SET_FILTER",payload:j});const U=await ee.getMediaItems(C);e({type:"SET_ITEMS",payload:U})}catch(C){e({type:"SET_ERROR",payload:C})}finally{e({type:"SET_LOADING",payload:!1})}},[t.filter]),f=c.useCallback(async(j,C)=>{try{e({type:"SET_ERROR",payload:null});const U=await ee.updateMedia(j,C);return e({type:"UPDATE_ITEM",payload:U}),U}catch(U){throw e({type:"SET_ERROR",payload:U}),U}},[]),p=c.useCallback(async j=>{try{e({type:"SET_ERROR",payload:null});const C=await ee.deleteMedia(j);return C&&e({type:"REMOVE_ITEM",payload:j}),C}catch(C){return e({type:"SET_ERROR",payload:C}),!1}},[]),l=c.useCallback(j=>{t.selectedItems.includes(j)||e({type:"SELECT_ITEM",payload:j})},[t.selectedItems]),h=c.useCallback(j=>{e({type:"DESELECT_ITEM",payload:j})},[]),m=c.useCallback(()=>{e({type:"SELECT_ALL"})},[]),b=c.useCallback(()=>{e({type:"DESELECT_ALL"})},[]),T=c.useCallback(j=>{e({type:"SET_FILTER",payload:j})},[]),w={state:t,importMedia:n,refreshMedia:s,updateMedia:f,deleteMedia:p,selectItem:l,deselectItem:h,selectAll:m,deselectAll:b,setFilter:T};return o.jsx(He.Provider,{value:w,children:r})},De=()=>{const r=c.useContext(He);if(r===void 0)throw new Error("useMedia must be used within a MediaProvider");return r},Ze=({selectedCount:r,totalCount:t,filter:e,onImport:n,onFilterChange:s,onDeleteSelected:f,onRefresh:p})=>{var S,R,u,v,L,Y,se,J,te;const{state:l}=De(),[h,m]=c.useState(e.search||""),[b,T]=c.useState(!1),[w,j]=c.useState([]),C=c.useRef(null);c.useEffect(()=>{const D=new Set;l.items.forEach(W=>{W.tags.forEach(X=>D.add(X))}),j(Array.from(D).sort())},[l.items]);const U=c.useCallback(D=>{const W=D.target.value;m(W),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{s({...e,search:W})},300)},[e,s]),q=c.useCallback((D,W)=>{const X=e.type||[];let G;W?G=[...X,D]:G=X.filter(re=>re!==D),s({...e,type:G.length>0?G:void 0})},[e,s]),M=c.useCallback(D=>{const W=D.target.checked;s({...e,favorite:W?!0:void 0})},[e,s]),A=c.useCallback((D,W)=>{const X=e.tags||[];let G;W?G=[...X,D]:G=X.filter(re=>re!==D),s({...e,tags:G.length>0?G:void 0})},[e,s]),de=c.useCallback(D=>{const W=D.target.value,[X,G]=W.split("-");s({...e,sortBy:X,sortDirection:G})},[e,s]),ue=`${e.sortBy||"name"}-${e.sortDirection||"asc"}`,fe=c.useCallback(()=>{m(""),s({})},[s]);return o.jsxs("div",{className:"media-toolbar",style:{display:"flex",flexDirection:"column",gap:"8px",padding:"12px",backgroundColor:"#212121",borderBottom:"1px solid #333"},children:[o.jsxs("div",{className:"media-toolbar-main",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px"},children:[o.jsxs("div",{className:"media-toolbar-left",style:{display:"flex",alignItems:"center",gap:"8px",flex:"1"},children:[o.jsxs("div",{className:"search-container",style:{flex:"1",position:"relative",maxWidth:"300px"},children:[o.jsx("input",{type:"text",placeholder:"ÎØ∏ÎîîÏñ¥ Í≤ÄÏÉâ...",value:h,onChange:U,style:{width:"100%",padding:"8px 12px",paddingLeft:"32px",backgroundColor:"#333",border:"none",borderRadius:"4px",color:"#fff",fontSize:"14px"}}),o.jsx("span",{style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"#aaa"},children:"üîç"}),h&&o.jsx("button",{onClick:()=>{m(""),s({...e,search:void 0})},style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",color:"#aaa",cursor:"pointer",fontSize:"14px"},children:"‚úï"})]}),o.jsxs("select",{value:ue,onChange:de,style:{padding:"7px 8px",backgroundColor:"#333",border:"none",borderRadius:"4px",color:"#fff",fontSize:"14px"},children:[o.jsx("option",{value:"name-asc",children:"Ïù¥Î¶Ñ (A-Z)"}),o.jsx("option",{value:"name-desc",children:"Ïù¥Î¶Ñ (Z-A)"}),o.jsx("option",{value:"importedAt-desc",children:"ÏµúÍ∑º Ï∂îÍ∞Ä"}),o.jsx("option",{value:"createdAt-desc",children:"ÏÉùÏÑ±Ïùº (ÏµúÏã†)"}),o.jsx("option",{value:"createdAt-asc",children:"ÏÉùÏÑ±Ïùº (Ïò§ÎûòÎêú)"}),o.jsx("option",{value:"size-desc",children:"ÌÅ¨Í∏∞ (ÌÅ∞ Ïàú)"}),o.jsx("option",{value:"size-asc",children:"ÌÅ¨Í∏∞ (ÏûëÏùÄ Ïàú)"}),o.jsx("option",{value:"duration-desc",children:"Í∏∏Ïù¥ (Í∏¥ Ïàú)"}),o.jsx("option",{value:"duration-asc",children:"Í∏∏Ïù¥ (ÏßßÏùÄ Ïàú)"})]}),o.jsxs("button",{onClick:()=>T(!b),title:b?"ÌïÑÌÑ∞ Ïà®Í∏∞Í∏∞":"ÌïÑÌÑ∞ ÌëúÏãú",style:{padding:"7px 10px",backgroundColor:(S=e.type)!=null&&S.length||(R=e.tags)!=null&&R.length||e.favorite?"#2196f3":"#333",border:"none",borderRadius:"4px",color:"#fff",fontSize:"14px",cursor:"pointer"},children:[b?"‚ñ≤":"‚ñº"," ÌïÑÌÑ∞",(((u=e.type)==null?void 0:u.length)||((v=e.tags)==null?void 0:v.length)||e.favorite)&&o.jsx("span",{style:{marginLeft:"5px",fontSize:"12px",backgroundColor:"#fff",color:"#333",borderRadius:"50%",padding:"0 5px"},children:(((L=e.type)==null?void 0:L.length)||0)+(((Y=e.tags)==null?void 0:Y.length)||0)+(e.favorite?1:0)})]}),o.jsx("button",{onClick:fe,title:"ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî",style:{padding:"7px 10px",backgroundColor:"#333",border:"none",borderRadius:"4px",color:"#aaa",fontSize:"14px",cursor:"pointer"},children:"‚Ü∫"})]}),o.jsxs("div",{className:"media-toolbar-right",style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("div",{className:"selection-counter",style:{color:"#aaa",fontSize:"14px"},children:r>0?`${r}Í∞ú ÏÑ†ÌÉùÎê®`:`${t}Í∞ú Ìï≠Î™©`}),o.jsx("button",{onClick:p,title:"ÏÉàÎ°úÍ≥†Ïπ®",style:{padding:"8px 12px",backgroundColor:"#333",border:"none",borderRadius:"4px",color:"#fff",fontSize:"14px",cursor:"pointer"},children:"‚Üª"}),o.jsx("button",{onClick:f,disabled:r===0,style:{padding:"8px 12px",backgroundColor:r===0?"#333":"#e53935",border:"none",borderRadius:"4px",color:r===0?"#777":"#fff",fontSize:"14px",cursor:r===0?"default":"pointer",opacity:r===0?.7:1},children:"ÏÇ≠Ï†ú"}),o.jsx("button",{onClick:n,style:{padding:"8px 16px",backgroundColor:"#2196f3",border:"none",borderRadius:"4px",color:"#fff",fontSize:"14px",cursor:"pointer"},children:"ÎØ∏ÎîîÏñ¥ Ï∂îÍ∞Ä"})]})]}),b&&o.jsxs("div",{className:"media-toolbar-filters",style:{display:"flex",flexDirection:"column",gap:"12px",fontSize:"14px",color:"#ccc",backgroundColor:"#2a2a2a",padding:"12px",borderRadius:"4px"},children:[o.jsxs("div",{className:"filter-group",children:[o.jsx("div",{style:{marginBottom:"8px",fontWeight:"bold"},children:"ÎØ∏ÎîîÏñ¥ ÌÉÄÏûÖ"}),o.jsxs("div",{style:{display:"flex",gap:"12px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[o.jsx("input",{type:"checkbox",checked:((se=e.type)==null?void 0:se.includes(g.VIDEO))||!1,onChange:D=>q(g.VIDEO,D.target.checked)}),"ÎπÑÎîîÏò§"]}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[o.jsx("input",{type:"checkbox",checked:((J=e.type)==null?void 0:J.includes(g.AUDIO))||!1,onChange:D=>q(g.AUDIO,D.target.checked)}),"Ïò§ÎîîÏò§"]}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[o.jsx("input",{type:"checkbox",checked:((te=e.type)==null?void 0:te.includes(g.IMAGE))||!1,onChange:D=>q(g.IMAGE,D.target.checked)}),"Ïù¥ÎØ∏ÏßÄ"]})]})]}),o.jsx("div",{className:"filter-group",children:o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[o.jsx("input",{type:"checkbox",checked:e.favorite||!1,onChange:M}),"Ï¶êÍ≤®Ï∞æÍ∏∞Îßå ÌëúÏãú"]})}),w.length>0&&o.jsxs("div",{className:"filter-group",children:[o.jsx("div",{style:{marginBottom:"8px",fontWeight:"bold"},children:"ÌÉúÍ∑∏"}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",maxHeight:"100px",overflowY:"auto",padding:"4px"},children:w.map(D=>{var W,X,G,re;return o.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:"4px",backgroundColor:(W=e.tags)!=null&&W.includes(D)?"#2196f3":"#454545",color:(X=e.tags)!=null&&X.includes(D)?"#fff":"#ddd",padding:"4px 8px",borderRadius:"16px",fontSize:"12px",cursor:"pointer"},children:[o.jsx("input",{type:"checkbox",checked:((G=e.tags)==null?void 0:G.includes(D))||!1,onChange:ge=>A(D,ge.target.checked),style:{display:"none"}}),D,((re=e.tags)==null?void 0:re.includes(D))&&o.jsx("span",{onClick:ge=>{ge.preventDefault(),A(D,!1)},style:{marginLeft:"2px",fontSize:"10px"},children:"‚úï"})]},D)})})]})]})]})};function Ae(r){if(r===0)return"0 Bytes";const t=1024,e=["Bytes","KB","MB","GB","TB"],n=Math.floor(Math.log(r)/Math.log(t));return parseFloat((r/Math.pow(t,n)).toFixed(2))+" "+e[n]}function Oe(r){if(isNaN(r))return"00:00";const t=Math.floor(r/3600),e=Math.floor(r%3600/60),n=Math.floor(r%60),s=f=>f.toString().padStart(2,"0");return t>0?`${s(t)}:${s(e)}:${s(n)}`:`${s(e)}:${s(n)}`}function ke(r){return typeof r=="string"&&(r=new Date(r)),r.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function _t(r){var e;const t=r.split(".");return t.length>1&&((e=t.pop())==null?void 0:e.toLowerCase())||""}function Mt(r){return r.split(/[\\/]/).pop()||""}const Qe=({item:r,isSelected:t,onSelect:e,onDoubleClick:n,onContextMenu:s,onDragStart:f})=>{const[p,l]=c.useState(!1),h=w=>{switch(w){case g.VIDEO:return"üé¨";case g.AUDIO:return"üéµ";case g.IMAGE:return"üñºÔ∏è";default:return"üìÅ"}},m=w=>{switch(w){case g.VIDEO:return"#3949ab";case g.AUDIO:return"#3498db";case g.IMAGE:return"#43a047";default:return"#333"}},b=w=>{l(!0);const j={id:r.id,type:r.type,name:r.name,duration:r.metadata.duration};if(w.dataTransfer.setData("application/json",JSON.stringify(j)),w.dataTransfer.effectAllowed="copy",f&&f(w,r),r.thumbnail){const C=new Image;C.src=r.thumbnail,w.dataTransfer.setDragImage(C,0,0)}},T=()=>{l(!1)};return o.jsxs("div",{className:`media-item ${t?"selected":""} ${p?"dragging":""}`,onClick:()=>e(r.id),onDoubleClick:()=>n&&n(r),onContextMenu:w=>s&&s(w,r),draggable:!0,onDragStart:b,onDragEnd:T,"data-media-id":r.id,"data-media-type":r.type,style:{position:"relative",width:"180px",margin:"8px",borderRadius:"6px",overflow:"hidden",backgroundColor:"#232323",border:t?"2px solid #2196f3":"2px solid transparent",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.2)",cursor:"pointer",transition:"all 0.2s ease",opacity:p?.6:1},children:[o.jsxs("div",{className:"media-thumbnail",style:{position:"relative",width:"100%",height:"120px",backgroundColor:r.thumbnail?"#333":m(r.type),backgroundImage:r.thumbnail?`url(${r.thumbnail})`:"none",backgroundSize:"cover",backgroundPosition:"center",display:"flex",alignItems:"center",justifyContent:"center"},children:[!r.thumbnail&&o.jsx("span",{style:{fontSize:"2rem"},children:h(r.type)}),o.jsx("div",{className:"media-type-badge",style:{position:"absolute",top:"8px",right:"8px",backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"12px"},children:r.type===g.AUDIO?"MP3":r.type}),r.favorite&&o.jsx("div",{className:"favorite-badge",style:{position:"absolute",top:"8px",left:"8px",color:"#ffcf00",fontSize:"16px"},children:"‚òÖ"}),r.metadata.duration&&(r.type===g.VIDEO||r.type===g.AUDIO)&&o.jsx("div",{className:"duration-badge",style:{position:"absolute",bottom:"8px",right:"8px",backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"12px"},children:Oe(r.metadata.duration)}),o.jsx("div",{className:"drag-hint",style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(33, 150, 243, 0.2)",display:t?"flex":"none",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",opacity:0,transition:"opacity 0.2s ease"},children:"ÌÉÄÏûÑÎùºÏù∏Ïóê ÎìúÎûòÍ∑∏"})]}),o.jsxs("div",{className:"media-info",style:{padding:"8px",color:"white"},children:[o.jsx("div",{className:"media-name",style:{fontSize:"14px",fontWeight:"bold",marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:r.name,children:r.name}),o.jsxs("div",{className:"media-details",style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#aaa"},children:[o.jsx("span",{children:Ae(r.size)}),r.metadata.width&&r.metadata.height&&o.jsxs("span",{children:[r.metadata.width," √ó ",r.metadata.height]})]}),r.tags.length>0&&o.jsxs("div",{className:"media-tags",style:{marginTop:"4px",display:"flex",flexWrap:"wrap",gap:"4px"},children:[r.tags.slice(0,2).map((w,j)=>o.jsx("span",{style:{backgroundColor:"#454545",color:"#ddd",padding:"2px 4px",borderRadius:"4px",fontSize:"10px"},children:w},j)),r.tags.length>2&&o.jsxs("span",{style:{color:"#aaa",fontSize:"10px"},children:["+",r.tags.length-2]})]})]}),o.jsx("style",{children:`
        .media-item:hover .drag-hint {
          opacity: 1;
        }
        
        .media-item.dragging {
          transform: scale(0.95);
        }
        `})]})},qe=({items:r,selectedItems:t,onSelectItem:e,onItemDoubleClick:n,onItemContextMenu:s,onItemDragStart:f})=>{const p=c.useCallback((h,m)=>{const b=(m==null?void 0:m.ctrlKey)||(m==null?void 0:m.metaKey)||(m==null?void 0:m.shiftKey);e(h,b)},[e]),l=c.useCallback(h=>{h.target===h.currentTarget&&e("",!1)},[e]);return o.jsx("div",{className:"media-grid",onClick:l,style:{display:"flex",flexWrap:"wrap",padding:"16px",overflow:"auto",height:"100%",backgroundColor:"#1a1a1a"},children:r.length===0?o.jsxs("div",{className:"media-grid-empty",style:{width:"100%",textAlign:"center",color:"#777",padding:"32px",fontSize:"16px"},children:[o.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"üìÅ"}),o.jsx("p",{children:"ÎØ∏ÎîîÏñ¥ ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§"}),o.jsx("p",{style:{fontSize:"14px"},children:"ÌååÏùºÏùÑ ÎìúÎûòÍ∑∏ÌïòÍ±∞ÎÇò Ï∂îÍ∞Ä Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÎØ∏ÎîîÏñ¥Î•º Í∞ÄÏ†∏Ïò§ÏÑ∏Ïöî"})]}):r.map(h=>o.jsx(Qe,{item:h,isSelected:t.includes(h.id),onSelect:m=>p(m),onDoubleClick:n,onContextMenu:s,onDragStart:f},h.id))})},$e=({item:r,onClose:t,onFavoriteToggle:e,onTagAdd:n,onTagRemove:s})=>{const[f,p]=c.useState(""),[l,h]=c.useState(!1),m=c.useRef(null),b=c.useRef(null),T=c.useRef(null);c.useEffect(()=>{const M=m.current,A=b.current;return()=>{M&&M.pause(),A&&A.pause()}},[r.id]);const w=async()=>{await e(r.id,!r.favorite)},j=async M=>{var A;M.preventDefault(),f.trim()!==""&&(await n(r.id,f.trim()),p(""),(A=T.current)==null||A.focus())},C=async M=>{await s(r.id,M)},U=M=>{if(M.dataTransfer.setData("application/json",JSON.stringify({id:r.id,type:r.type,name:r.name,duration:r.metadata.duration})),r.thumbnail){const A=new Image;A.src=r.thumbnail,M.dataTransfer.setDragImage(A,0,0)}M.dataTransfer.effectAllowed="copy"},q=()=>{switch(r.type){case g.VIDEO:return o.jsxs("div",{className:"video-container",style:{position:"relative"},children:[o.jsx("video",{ref:m,src:r.url,controls:!0,style:{width:"100%",height:"auto",maxHeight:"250px",backgroundColor:"#000",objectFit:"contain"}}),o.jsx("div",{className:"drag-overlay",draggable:!0,onDragStart:U,style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(33, 150, 243, 0.1)",color:"transparent",cursor:"grab",zIndex:1,opacity:0,transition:"all 0.2s ease"},children:"ÌÉÄÏûÑÎùºÏù∏Ïóê ÎìúÎûòÍ∑∏"})]});case g.AUDIO:return o.jsxs("div",{style:{padding:"20px",textAlign:"center",position:"relative"},children:[o.jsx("audio",{ref:b,src:r.url,controls:!0,style:{width:"100%"}}),o.jsx("div",{style:{marginTop:"16px",fontSize:"48px",color:"#aaa"},draggable:!0,onDragStart:U,children:"üéµ"}),o.jsx("div",{className:"drag-hint",style:{marginTop:"8px",fontSize:"12px",color:"#888"},children:"ÌÉÄÏûÑÎùºÏù∏Ïóê ÎìúÎûòÍ∑∏ÌïòÏó¨ Ï∂îÍ∞Ä"})]});case g.IMAGE:return o.jsxs("div",{style:{position:"relative"},children:[o.jsx("img",{src:r.url,alt:r.name,style:{width:"100%",height:"auto",maxHeight:"250px",objectFit:"contain"},draggable:!0,onDragStart:U}),o.jsx("div",{className:"drag-hint",style:{position:"absolute",bottom:"8px",right:"8px",backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",opacity:0,transition:"opacity 0.2s ease"},children:"ÎìúÎûòÍ∑∏ÌïòÏó¨ ÌÉÄÏûÑÎùºÏù∏Ïóê Ï∂îÍ∞Ä"})]});default:return o.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#aaa"},children:"ÎØ∏Î¶¨Î≥¥Í∏∞Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏùå"})}};return o.jsxs("div",{className:"media-preview",style:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:"#232323"},children:[o.jsxs("div",{className:"preview-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #333"},children:[o.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:r.name,children:r.name}),o.jsxs("div",{className:"preview-actions",children:[o.jsx("button",{onClick:w,title:r.favorite?"Ï¶êÍ≤®Ï∞æÍ∏∞ Ìï¥Ï†ú":"Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä",style:{background:"none",border:"none",fontSize:"18px",color:r.favorite?"#ffcf00":"#777",cursor:"pointer",marginRight:"8px"},children:r.favorite?"‚òÖ":"‚òÜ"}),o.jsx("button",{onClick:t,title:"ÎØ∏Î¶¨Î≥¥Í∏∞ Îã´Í∏∞",style:{background:"none",border:"none",fontSize:"18px",color:"#777",cursor:"pointer"},children:"‚úï"})]})]}),o.jsx("div",{className:"preview-content",style:{borderBottom:"1px solid #333"},children:q()}),o.jsxs("div",{className:"preview-details",style:{flex:1,overflow:"auto",padding:"16px"},children:[o.jsx("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},children:o.jsxs("tbody",{children:[o.jsxs("tr",{children:[o.jsx("td",{style:{padding:"4px 8px 4px 0",color:"#aaa",width:"40%"},children:"ÌÉÄÏûÖ"}),o.jsx("td",{style:{padding:"4px 0"},children:r.type.charAt(0).toUpperCase()+r.type.slice(1)})]}),o.jsxs("tr",{children:[o.jsx("td",{style:{padding:"4px 8px 4px 0",color:"#aaa"},children:"ÌÅ¨Í∏∞"}),o.jsx("td",{style:{padding:"4px 0"},children:Ae(r.size)})]}),r.metadata.duration!==void 0&&o.jsxs("tr",{children:[o.jsx("td",{style:{padding:"4px 8px 4px 0",color:"#aaa"},children:"Í∏∏Ïù¥"}),o.jsx("td",{style:{padding:"4px 0"},children:Oe(r.metadata.duration)})]}),r.metadata.width&&r.metadata.height&&o.jsxs("tr",{children:[o.jsx("td",{style:{padding:"4px 8px 4px 0",color:"#aaa"},children:"Ìï¥ÏÉÅÎèÑ"}),o.jsxs("td",{style:{padding:"4px 0"},children:[r.metadata.width," √ó ",r.metadata.height]})]}),r.metadata.frameRate!==void 0&&o.jsxs("tr",{children:[o.jsx("td",{style:{padding:"4px 8px 4px 0",color:"#aaa"},children:"ÌîÑÎ†àÏûÑ Î†àÏù¥Ìä∏"}),o.jsxs("td",{style:{padding:"4px 0"},children:[r.metadata.frameRate," fps"]})]}),r.metadata.codec&&o.jsxs("tr",{children:[o.jsx("td",{style:{padding:"4px 8px 4px 0",color:"#aaa"},children:"ÏΩîÎç±"}),o.jsx("td",{style:{padding:"4px 0"},children:r.metadata.codec})]}),r.metadata.channels!==void 0&&o.jsxs("tr",{children:[o.jsx("td",{style:{padding:"4px 8px 4px 0",color:"#aaa"},children:"Ïò§ÎîîÏò§ Ï±ÑÎÑê"}),o.jsxs("td",{style:{padding:"4px 0"},children:[r.metadata.channels,"Ï±ÑÎÑê"]})]}),r.metadata.sampleRate!==void 0&&o.jsxs("tr",{children:[o.jsx("td",{style:{padding:"4px 8px 4px 0",color:"#aaa"},children:"ÏÉòÌîå Î†àÏù¥Ìä∏"}),o.jsxs("td",{style:{padding:"4px 0"},children:[r.metadata.sampleRate," Hz"]})]}),o.jsxs("tr",{children:[o.jsx("td",{style:{padding:"4px 8px 4px 0",color:"#aaa"},children:"ÏÉùÏÑ±Ïùº"}),o.jsx("td",{style:{padding:"4px 0"},children:ke(r.createdAt)})]}),o.jsxs("tr",{children:[o.jsx("td",{style:{padding:"4px 8px 4px 0",color:"#aaa"},children:"Í∞ÄÏ†∏Ïò® ÎÇ†Ïßú"}),o.jsx("td",{style:{padding:"4px 0"},children:ke(r.importedAt)})]})]})}),o.jsxs("div",{className:"tags-section",style:{marginTop:"16px"},children:[o.jsx("h4",{style:{margin:"0 0 8px 0",fontSize:"14px",color:"#ccc"},children:"ÌÉúÍ∑∏"}),o.jsx("div",{className:"tags-list",style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"12px"},children:r.tags.length===0?o.jsx("div",{style:{color:"#777",fontSize:"13px",fontStyle:"italic"},children:"ÌÉúÍ∑∏ ÏóÜÏùå"}):r.tags.map((M,A)=>o.jsxs("div",{className:"tag",style:{backgroundColor:"#454545",color:"#fff",padding:"4px 8px",borderRadius:"16px",fontSize:"13px",display:"flex",alignItems:"center"},children:[o.jsx("span",{children:M}),o.jsx("button",{onClick:()=>C(M),title:`ÌÉúÍ∑∏ ÏÇ≠Ï†ú: ${M}`,style:{background:"none",border:"none",color:"#aaa",fontSize:"12px",cursor:"pointer",marginLeft:"4px",padding:"0 2px"},children:"‚úï"})]},A))}),o.jsx("form",{onSubmit:j,children:o.jsxs("div",{className:`tag-input-container ${l?"focused":""}`,style:{display:"flex",position:"relative"},children:[o.jsx("input",{ref:T,type:"text",value:f,onChange:M=>p(M.target.value),onFocus:()=>h(!0),onBlur:()=>h(!1),placeholder:"ÏÉà ÌÉúÍ∑∏ Ï∂îÍ∞Ä...",style:{flex:1,padding:"6px 10px",backgroundColor:"#333",border:l?"1px solid #2196f3":"1px solid #444",borderRadius:"4px",color:"#fff",fontSize:"13px",outline:"none",transition:"border-color 0.2s ease"}}),o.jsx("button",{type:"submit",disabled:!f.trim(),style:{padding:"6px 12px",backgroundColor:f.trim()?"#2196f3":"#444",border:"none",borderRadius:"0 4px 4px 0",color:"#fff",fontSize:"13px",cursor:f.trim()?"pointer":"default",position:"absolute",right:0,top:0,bottom:0},children:"Ï∂îÍ∞Ä"})]})}),o.jsxs("div",{className:"timeline-hint",style:{marginTop:"16px",padding:"8px 12px",backgroundColor:"rgba(33, 150, 243, 0.1)",borderRadius:"4px",fontSize:"13px",color:"#2196f3",display:"flex",alignItems:"center",gap:"8px",cursor:"grab"},draggable:!0,onDragStart:U,children:[o.jsx("span",{style:{fontSize:"16px"},children:"‚ÜóÔ∏è"}),o.jsx("span",{children:"Ïù¥ ÎØ∏ÎîîÏñ¥Î•º ÌÉÄÏûÑÎùºÏù∏ÏúºÎ°ú ÎìúÎûòÍ∑∏ÌïòÏó¨ Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî"})]})]})]}),o.jsx("style",{children:`
        .video-container:hover .drag-overlay {
          opacity: 1;
        }
        
        .preview-content:hover .drag-hint {
          opacity: 1;
        }
        `})]})},Lt=({onSelect:r,onDragStart:t})=>{const{state:{items:e,selectedItems:n,filter:s,isLoading:f},importMedia:p,refreshMedia:l,updateMedia:h,deleteMedia:m,selectItem:b,deselectItem:T,deselectAll:w,setFilter:j}=De(),[C,U]=c.useState(null),q=c.useRef(null),M=c.useCallback(()=>{var u;(u=q.current)==null||u.click()},[]),A=c.useCallback(async u=>{const v=u.target.files;!v||v.length===0||(await p(Array.from(v)),u.target.value="")},[p]),de=c.useCallback(async u=>{u.preventDefault(),u.stopPropagation();const v=u.dataTransfer.files;v.length!==0&&await p(Array.from(v))},[p]),ue=c.useCallback(u=>{u.preventDefault(),u.stopPropagation()},[]),fe=c.useCallback((u,v=!1)=>{if(u===""){w(),U(null);return}v?n.includes(u)?T(u):b(u):(w(),b(u));const L=e.find(Y=>Y.id===u);L&&U(L)},[n,e,b,T,w]),S=c.useCallback(u=>{r&&r([u])},[r]),R=c.useCallback(async()=>{if(!(n.length===0||!window.confirm(`ÏÑ†ÌÉùÌïú ${n.length}Í∞ú Ìï≠Î™©ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`))){for(const v of n)await m(v);U(null)}},[n,m]);return c.useEffect(()=>{(async()=>{try{await l()}catch(v){console.error("ÎØ∏ÎîîÏñ¥ Î°úÎìú Ïã§Ìå®:",v)}})()},[]),o.jsxs("div",{className:"media-manager",style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",backgroundColor:"#1a1a1a",color:"#fff"},onDrop:de,onDragOver:ue,children:[o.jsx(Ze,{selectedCount:n.length,totalCount:e.length,filter:s,onImport:M,onFilterChange:j,onDeleteSelected:R,onRefresh:()=>l()}),o.jsxs("div",{className:"media-content",style:{display:"flex",flex:1,overflow:"hidden"},children:[o.jsxs("div",{className:"media-grid-container",style:{flex:3,overflow:"hidden",position:"relative",borderRight:"1px solid #333"},children:[f&&o.jsx("div",{className:"loading-overlay",style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.6)",zIndex:10},children:o.jsx("div",{className:"spinner",style:{color:"#fff",fontSize:"16px"},children:"Î°úÎî© Ï§ë..."})}),o.jsx(qe,{items:e,selectedItems:n,onSelectItem:fe,onItemDoubleClick:S,onItemDragStart:t})]}),o.jsx("div",{className:"media-preview-container",style:{flex:1,minWidth:"300px",display:"flex",flexDirection:"column",overflow:"hidden"},children:C?o.jsx($e,{item:C,onClose:()=>U(null),onFavoriteToggle:async(u,v)=>{await h(u,{favorite:v})},onTagAdd:async(u,v)=>{const L=e.find(Y=>Y.id===u);L&&!L.tags.includes(v)&&await h(u,{tags:[...L.tags,v]})},onTagRemove:async(u,v)=>{const L=e.find(Y=>Y.id===u);L&&await h(u,{tags:L.tags.filter(Y=>Y!==v)})}}):o.jsxs("div",{className:"no-preview",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#777",padding:"20px",textAlign:"center"},children:[o.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"üëÜ"}),o.jsx("p",{children:"Ìï≠Î™©ÏùÑ ÏÑ†ÌÉùÌïòÏó¨ ÎØ∏Î¶¨Î≥¥Í∏∞"}),o.jsx("p",{style:{fontSize:"14px",marginTop:"8px"},children:"ÎØ∏ÎîîÏñ¥ ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ ÎØ∏Î¶¨Î≥¥Í∏∞ÏôÄ ÏÉÅÏÑ∏ Ï†ïÎ≥¥Í∞Ä ÌëúÏãúÎê©ÎãàÎã§"})]})})]}),o.jsx("input",{type:"file",ref:q,onChange:A,multiple:!0,accept:"audio/mp3,.mp3",style:{display:"none"}})]})},Pt=()=>{const[r,t]=c.useState([]),[e,n]=c.useState([]),[s,f]=c.useState(!1),[p,l]=c.useState(null),[h,m]=c.useState({}),b=c.useCallback(async S=>{try{f(!0),l(null),await ne.load();const R=await ee.importMedia(S);return t(u=>[...u,...R]),R}catch(R){const u=R instanceof Error?R:new Error("ÎØ∏ÎîîÏñ¥ ÏûÑÌè¨Ìä∏ Ï§ë Ïò§Î•ò Î∞úÏÉù");return l(u),[]}finally{f(!1)}},[]),T=c.useCallback(async S=>{try{f(!0),l(null);const R=S||h;S&&m(S);const u=await ee.getMediaItems(R);t(u)}catch(R){const u=R instanceof Error?R:new Error("ÎØ∏ÎîîÏñ¥ ÏÉàÎ°úÍ≥†Ïπ® Ï§ë Ïò§Î•ò Î∞úÏÉù");l(u)}finally{f(!1)}},[h]),w=c.useCallback(async(S,R)=>{try{l(null);const u=await ee.updateMedia(S,R);return t(v=>v.map(L=>L.id===S?u:L)),u}catch(u){const v=u instanceof Error?u:new Error("ÎØ∏ÎîîÏñ¥ ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Ïò§Î•ò Î∞úÏÉù");throw l(v),v}},[]),j=c.useCallback(async S=>{try{l(null);const R=await ee.deleteMedia(S);return R&&(t(u=>u.filter(v=>v.id!==S)),n(u=>u.filter(v=>v!==S))),R}catch(R){const u=R instanceof Error?R:new Error("ÎØ∏ÎîîÏñ¥ ÏÇ≠Ï†ú Ï§ë Ïò§Î•ò Î∞úÏÉù");return l(u),!1}},[]),C=c.useCallback(async S=>{try{return l(null),await ne.load(),await ee.extractMetadata(S)}catch(R){const u=R instanceof Error?R:new Error("Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú Ï§ë Ïò§Î•ò Î∞úÏÉù");throw l(u),u}},[]),U=c.useCallback(async(S,R)=>{try{l(null);const u=await ee.generateThumbnail(S,R);return t(v=>v.map(L=>L.id===S.id?{...L,thumbnail:u}:L)),u}catch(u){const v=u instanceof Error?u:new Error("Ïç∏ÎÑ§Ïùº ÏÉùÏÑ± Ï§ë Ïò§Î•ò Î∞úÏÉù");throw l(v),v}},[]),q=c.useCallback(async(S,R,u,v={})=>{try{const L=new Date,se={id:Ye(),name:S,type:R,path:u,url:u,size:0,createdAt:L,importedAt:L,metadata:v,tags:[],favorite:!1,thumbnail:""};return t(J=>[...J,se]),se}catch(L){const Y=L instanceof Error?L:new Error("ÎØ∏ÎîîÏñ¥ Ìï≠Î™© ÏÉùÏÑ± Ï§ë Ïò§Î•ò Î∞úÏÉù");throw l(Y),Y}},[]),M=c.useCallback(S=>{n(R=>R.includes(S)?R:[...R,S])},[]),A=c.useCallback(S=>{n(R=>R.filter(u=>u!==S))},[]),de=c.useCallback(()=>{n(r.map(S=>S.id))},[r]),ue=c.useCallback(()=>{n([])},[]),fe=c.useCallback(S=>{m(S),T(S)},[T]);return c.useEffect(()=>(T(),()=>{ne.terminate().catch(console.error)}),[T]),{items:r,selectedItems:e,isLoading:s,error:p,filter:h,importMedia:b,refreshMedia:T,updateMedia:w,deleteMedia:j,extractMetadata:C,generateThumbnail:U,createMediaItem:q,selectItem:M,deselectItem:A,selectAll:de,deselectAll:ue,applyFilter:fe}};y.FFmpegService=ne,y.MediaGrid=qe,y.MediaItem=Qe,y.MediaManager=Lt,y.MediaPreview=$e,y.MediaProvider=kt,y.MediaService=ee,y.MediaToolbar=Ze,y.MediaType=g,y.formatDate=ke,y.formatDuration=Oe,y.formatFileSize=Ae,y.getBasename=Mt,y.getFileExtension=_t,y.useMedia=Pt,y.useMediaContext=De,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
