(function(j,v){typeof exports=="object"&&typeof module<"u"?v(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],v):(j=typeof globalThis<"u"?globalThis:j||self,v(j.AudioEditor={},j.React))})(this,function(j,v){"use strict";var Ft=Object.defineProperty;var Dt=(j,v,K)=>v in j?Ft(j,v,{enumerable:!0,configurable:!0,writable:!0,value:K}):j[v]=K;var Y=(j,v,K)=>(Dt(j,typeof v!="symbol"?v+"":v,K),K);var K={exports:{}},oe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ne;function rt(){if(Ne)return oe;Ne=1;var n=v,e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function d(m,y,p){var x,A={},N=null,V=null;p!==void 0&&(N=""+p),y.key!==void 0&&(N=""+y.key),y.ref!==void 0&&(V=y.ref);for(x in y)r.call(y,x)&&!i.hasOwnProperty(x)&&(A[x]=y[x]);if(m&&m.defaultProps)for(x in y=m.defaultProps,y)A[x]===void 0&&(A[x]=y[x]);return{$$typeof:e,type:m,key:N,ref:V,props:A,_owner:a.current}}return oe.Fragment=t,oe.jsx=d,oe.jsxs=d,oe}var re={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _e;function nt(){return _e||(_e=1,process.env.NODE_ENV!=="production"&&function(){var n=v,e=Symbol.for("react.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),m=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),x=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),V=Symbol.for("react.offscreen"),I=Symbol.iterator,R="@@iterator";function g(o){if(o===null||typeof o!="object")return null;var l=I&&o[I]||o[R];return typeof l=="function"?l:null}var b=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function T(o){{for(var l=arguments.length,c=new Array(l>1?l-1:0),C=1;C<l;C++)c[C-1]=arguments[C];L("error",o,c)}}function L(o,l,c){{var C=b.ReactDebugCurrentFrame,S=C.getStackAddendum();S!==""&&(l+="%s",c=c.concat([S]));var P=c.map(function(k){return String(k)});P.unshift("Warning: "+l),Function.prototype.apply.call(console[o],console,P)}}var Z=!1,q=!1,W=!1,xe=!1,ye=!1,de;de=Symbol.for("react.module.reference");function ve(o){return!!(typeof o=="string"||typeof o=="function"||o===r||o===i||ye||o===a||o===p||o===x||xe||o===V||Z||q||W||typeof o=="object"&&o!==null&&(o.$$typeof===N||o.$$typeof===A||o.$$typeof===d||o.$$typeof===m||o.$$typeof===y||o.$$typeof===de||o.getModuleId!==void 0))}function be(o,l,c){var C=o.displayName;if(C)return C;var S=l.displayName||l.name||"";return S!==""?c+"("+S+")":c}function u(o){return o.displayName||"Context"}function f(o){if(o==null)return null;if(typeof o.tag=="number"&&T("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case r:return"Fragment";case t:return"Portal";case i:return"Profiler";case a:return"StrictMode";case p:return"Suspense";case x:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case m:var l=o;return u(l)+".Consumer";case d:var c=o;return u(c._context)+".Provider";case y:return be(o,o.render,"ForwardRef");case A:var C=o.displayName||null;return C!==null?C:f(o.type)||"Memo";case N:{var S=o,P=S._payload,k=S._init;try{return f(k(P))}catch{return null}}}return null}var h=Object.assign,_=0,$,H,ne,M,ae,G,se;function ue(){}ue.__reactDisabledLog=!0;function fe(){{if(_===0){$=console.log,H=console.info,ne=console.warn,M=console.error,ae=console.group,G=console.groupCollapsed,se=console.groupEnd;var o={configurable:!0,enumerable:!0,value:ue,writable:!0};Object.defineProperties(console,{info:o,log:o,warn:o,error:o,group:o,groupCollapsed:o,groupEnd:o})}_++}}function Ce(){{if(_--,_===0){var o={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:h({},o,{value:$}),info:h({},o,{value:H}),warn:h({},o,{value:ne}),error:h({},o,{value:M}),group:h({},o,{value:ae}),groupCollapsed:h({},o,{value:G}),groupEnd:h({},o,{value:se})})}_<0&&T("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Q=b.ReactCurrentDispatcher,Ee;function pe(o,l,c){{if(Ee===void 0)try{throw Error()}catch(S){var C=S.stack.trim().match(/\n( *(at )?)/);Ee=C&&C[1]||""}return`
`+Ee+o}}var Te=!1,he;{var dt=typeof WeakMap=="function"?WeakMap:Map;he=new dt}function ze(o,l){if(!o||Te)return"";{var c=he.get(o);if(c!==void 0)return c}var C;Te=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var P;P=Q.current,Q.current=null,fe();try{if(l){var k=function(){throw Error()};if(Object.defineProperty(k.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(k,[])}catch(U){C=U}Reflect.construct(o,[],k)}else{try{k.call()}catch(U){C=U}o.call(k.prototype)}}else{try{throw Error()}catch(U){C=U}o()}}catch(U){if(U&&C&&typeof U.stack=="string"){for(var E=U.stack.split(`
`),B=C.stack.split(`
`),O=E.length-1,F=B.length-1;O>=1&&F>=0&&E[O]!==B[F];)F--;for(;O>=1&&F>=0;O--,F--)if(E[O]!==B[F]){if(O!==1||F!==1)do if(O--,F--,F<0||E[O]!==B[F]){var z=`
`+E[O].replace(" at new "," at ");return o.displayName&&z.includes("<anonymous>")&&(z=z.replace("<anonymous>",o.displayName)),typeof o=="function"&&he.set(o,z),z}while(O>=1&&F>=0);break}}}finally{Te=!1,Q.current=P,Ce(),Error.prepareStackTrace=S}var te=o?o.displayName||o.name:"",J=te?pe(te):"";return typeof o=="function"&&he.set(o,J),J}function ut(o,l,c){return ze(o,!1)}function ft(o){var l=o.prototype;return!!(l&&l.isReactComponent)}function ge(o,l,c){if(o==null)return"";if(typeof o=="function")return ze(o,ft(o));if(typeof o=="string")return pe(o);switch(o){case p:return pe("Suspense");case x:return pe("SuspenseList")}if(typeof o=="object")switch(o.$$typeof){case y:return ut(o.render);case A:return ge(o.type,l,c);case N:{var C=o,S=C._payload,P=C._init;try{return ge(P(S),l,c)}catch{}}}return""}var ie=Object.prototype.hasOwnProperty,We={},Ge=b.ReactDebugCurrentFrame;function me(o){if(o){var l=o._owner,c=ge(o.type,o._source,l?l.type:null);Ge.setExtraStackFrame(c)}else Ge.setExtraStackFrame(null)}function pt(o,l,c,C,S){{var P=Function.call.bind(ie);for(var k in o)if(P(o,k)){var E=void 0;try{if(typeof o[k]!="function"){var B=Error((C||"React class")+": "+c+" type `"+k+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof o[k]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw B.name="Invariant Violation",B}E=o[k](l,k,C,c,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(O){E=O}E&&!(E instanceof Error)&&(me(S),T("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",C||"React class",c,k,typeof E),me(null)),E instanceof Error&&!(E.message in We)&&(We[E.message]=!0,me(S),T("Failed %s type: %s",c,E.message),me(null))}}}var ht=Array.isArray;function ke(o){return ht(o)}function gt(o){{var l=typeof Symbol=="function"&&Symbol.toStringTag,c=l&&o[Symbol.toStringTag]||o.constructor.name||"Object";return c}}function mt(o){try{return Ye(o),!1}catch{return!0}}function Ye(o){return""+o}function Ke(o){if(mt(o))return T("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",gt(o)),Ye(o)}var le=b.ReactCurrentOwner,xt={key:!0,ref:!0,__self:!0,__source:!0},He,Qe,we;we={};function yt(o){if(ie.call(o,"ref")){var l=Object.getOwnPropertyDescriptor(o,"ref").get;if(l&&l.isReactWarning)return!1}return o.ref!==void 0}function vt(o){if(ie.call(o,"key")){var l=Object.getOwnPropertyDescriptor(o,"key").get;if(l&&l.isReactWarning)return!1}return o.key!==void 0}function bt(o,l){if(typeof o.ref=="string"&&le.current&&l&&le.current.stateNode!==l){var c=f(le.current.type);we[c]||(T('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',f(le.current.type),o.ref),we[c]=!0)}}function Ct(o,l){{var c=function(){He||(He=!0,T("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",l))};c.isReactWarning=!0,Object.defineProperty(o,"key",{get:c,configurable:!0})}}function Et(o,l){{var c=function(){Qe||(Qe=!0,T("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",l))};c.isReactWarning=!0,Object.defineProperty(o,"ref",{get:c,configurable:!0})}}var Tt=function(o,l,c,C,S,P,k){var E={$$typeof:e,type:o,key:l,ref:c,props:k,_owner:P};return E._store={},Object.defineProperty(E._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(E,"_self",{configurable:!1,enumerable:!1,writable:!1,value:C}),Object.defineProperty(E,"_source",{configurable:!1,enumerable:!1,writable:!1,value:S}),Object.freeze&&(Object.freeze(E.props),Object.freeze(E)),E};function kt(o,l,c,C,S){{var P,k={},E=null,B=null;c!==void 0&&(Ke(c),E=""+c),vt(l)&&(Ke(l.key),E=""+l.key),yt(l)&&(B=l.ref,bt(l,S));for(P in l)ie.call(l,P)&&!xt.hasOwnProperty(P)&&(k[P]=l[P]);if(o&&o.defaultProps){var O=o.defaultProps;for(P in O)k[P]===void 0&&(k[P]=O[P])}if(E||B){var F=typeof o=="function"?o.displayName||o.name||"Unknown":o;E&&Ct(k,F),B&&Et(k,F)}return Tt(o,E,B,S,C,le.current,k)}}var Re=b.ReactCurrentOwner,Je=b.ReactDebugCurrentFrame;function ee(o){if(o){var l=o._owner,c=ge(o.type,o._source,l?l.type:null);Je.setExtraStackFrame(c)}else Je.setExtraStackFrame(null)}var Se;Se=!1;function Ae(o){return typeof o=="object"&&o!==null&&o.$$typeof===e}function Xe(){{if(Re.current){var o=f(Re.current.type);if(o)return`

Check the render method of \``+o+"`."}return""}}function wt(o){{if(o!==void 0){var l=o.fileName.replace(/^.*[\\\/]/,""),c=o.lineNumber;return`

Check your code at `+l+":"+c+"."}return""}}var Ze={};function Rt(o){{var l=Xe();if(!l){var c=typeof o=="string"?o:o.displayName||o.name;c&&(l=`

Check the top-level render call using <`+c+">.")}return l}}function qe(o,l){{if(!o._store||o._store.validated||o.key!=null)return;o._store.validated=!0;var c=Rt(l);if(Ze[c])return;Ze[c]=!0;var C="";o&&o._owner&&o._owner!==Re.current&&(C=" It was passed a child from "+f(o._owner.type)+"."),ee(o),T('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',c,C),ee(null)}}function et(o,l){{if(typeof o!="object")return;if(ke(o))for(var c=0;c<o.length;c++){var C=o[c];Ae(C)&&qe(C,l)}else if(Ae(o))o._store&&(o._store.validated=!0);else if(o){var S=g(o);if(typeof S=="function"&&S!==o.entries)for(var P=S.call(o),k;!(k=P.next()).done;)Ae(k.value)&&qe(k.value,l)}}}function St(o){{var l=o.type;if(l==null||typeof l=="string")return;var c;if(typeof l=="function")c=l.propTypes;else if(typeof l=="object"&&(l.$$typeof===y||l.$$typeof===A))c=l.propTypes;else return;if(c){var C=f(l);pt(c,o.props,"prop",C,o)}else if(l.PropTypes!==void 0&&!Se){Se=!0;var S=f(l);T("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",S||"Unknown")}typeof l.getDefaultProps=="function"&&!l.getDefaultProps.isReactClassApproved&&T("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function At(o){{for(var l=Object.keys(o.props),c=0;c<l.length;c++){var C=l[c];if(C!=="children"&&C!=="key"){ee(o),T("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",C),ee(null);break}}o.ref!==null&&(ee(o),T("Invalid attribute `ref` supplied to `React.Fragment`."),ee(null))}}var tt={};function ot(o,l,c,C,S,P){{var k=ve(o);if(!k){var E="";(o===void 0||typeof o=="object"&&o!==null&&Object.keys(o).length===0)&&(E+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var B=wt(S);B?E+=B:E+=Xe();var O;o===null?O="null":ke(o)?O="array":o!==void 0&&o.$$typeof===e?(O="<"+(f(o.type)||"Unknown")+" />",E=" Did you accidentally export a JSX literal instead of a component?"):O=typeof o,T("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",O,E)}var F=kt(o,l,c,S,P);if(F==null)return F;if(k){var z=l.children;if(z!==void 0)if(C)if(ke(z)){for(var te=0;te<z.length;te++)et(z[te],o);Object.freeze&&Object.freeze(z)}else T("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else et(z,o)}if(ie.call(l,"key")){var J=f(o),U=Object.keys(l).filter(function(Vt){return Vt!=="key"}),Pe=U.length>0?"{key: someKey, "+U.join(": ..., ")+": ...}":"{key: someKey}";if(!tt[J+Pe]){var Ot=U.length>0?"{"+U.join(": ..., ")+": ...}":"{}";T(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Pe,J,Ot,J),tt[J+Pe]=!0}}return o===r?At(F):St(F),F}}function Pt(o,l,c){return ot(o,l,c,!0)}function Nt(o,l,c){return ot(o,l,c,!1)}var _t=Nt,jt=Pt;re.Fragment=r,re.jsx=_t,re.jsxs=jt}()),re}process.env.NODE_ENV==="production"?K.exports=rt():K.exports=nt();var s=K.exports;let ce;const at=new Uint8Array(16);function st(){if(!ce&&(ce=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ce))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ce(at)}const D=[];for(let n=0;n<256;++n)D.push((n+256).toString(16).slice(1));function it(n,e=0){return D[n[e+0]]+D[n[e+1]]+D[n[e+2]]+D[n[e+3]]+"-"+D[n[e+4]]+D[n[e+5]]+"-"+D[n[e+6]]+D[n[e+7]]+"-"+D[n[e+8]]+D[n[e+9]]+"-"+D[n[e+10]]+D[n[e+11]]+D[n[e+12]]+D[n[e+13]]+D[n[e+14]]+D[n[e+15]]}const je={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Oe(n,e,t){if(je.randomUUID&&!e&&!n)return je.randomUUID();n=n||{};const r=n.random||(n.rng||st)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let a=0;a<16;++a)e[t+a]=r[a];return e}return it(r)}var w=(n=>(n.GAIN="gain",n.EQ="eq",n.COMPRESSOR="compressor",n.REVERB="reverb",n.DELAY="delay",n.NOISE_REDUCTION="noiseReduction",n.FADE="fade",n.LIMITER="limiter",n.PITCH_SHIFT="pitchShift",n.TIME_STRETCH="timeStretch",n))(w||{});class Ve{constructor(){Y(this,"audioContext");Y(this,"masterGainNode");Y(this,"trackNodes",new Map);Y(this,"effectNodes",new Map);Y(this,"isPlaying",!1);Y(this,"isPaused",!1);Y(this,"startTime",0);Y(this,"pauseTime",0);Y(this,"isInitialized",!1);try{const e=window.AudioContext||window.webkitAudioContext;if(!e)throw new Error("AudioContext is not supported in this environment");this.audioContext=new e,console.log("AudioContext 생성 성공:",this.audioContext.state),this.masterGainNode=this.audioContext.createGain(),this.masterGainNode.gain.value=1,this.masterGainNode.connect(this.audioContext.destination),this.isInitialized=!1,this.isPlaying=!1,this.isPaused=!1,this.trackNodes=new Map,this.startTime=0,this.pauseTime=0,this.setupAutoResume(),process.env.NODE_ENV!=="production"&&(window.__audioService=this,console.log("AudioService 인스턴스가 전역 객체에 추가되었습니다. window.__audioService로 접근 가능합니다."))}catch(e){console.error("AudioService 초기화 중 오류 발생:",e)}}setupAutoResume(){const e=()=>{this.audioContext.state==="suspended"&&this.audioContext.resume().then(()=>{console.log("사용자 상호작용으로 AudioContext가 재개되었습니다.")}).catch(t=>{console.error("AudioContext 재개 실패:",t)})};["click","touchstart","keydown"].forEach(t=>{document.addEventListener(t,e,{once:!0})})}initialize(){if(this.isInitialized){console.log("AudioService가 이미 초기화되어 있습니다.");return}try{console.log("AudioService 초기화 시작..."),this.audioContext?console.log(`기존 AudioContext 사용, 상태: ${this.audioContext.state}`):(this.audioContext=new(window.AudioContext||window.webkitAudioContext),console.log(`AudioContext 생성됨, 상태: ${this.audioContext.state}, 샘플레이트: ${this.audioContext.sampleRate}Hz`)),this.masterGainNode||(this.masterGainNode=this.audioContext.createGain(),this.masterGainNode.gain.value=1,this.masterGainNode.connect(this.audioContext.destination),console.log("마스터 게인 노드가 오디오 출력에 연결됨")),this.trackNodes=new Map,this.effectNodes=new Map,this.isPlaying=!1,this.startTime=0,this.pauseTime=0,this.isInitialized=!0,console.log("AudioService 초기화 완료"),process.env.NODE_ENV!=="production"&&(window.__audioService=this,console.log("AudioService 인스턴스가 전역 객체에 추가되었습니다. window.__audioService로 접근 가능합니다."))}catch(e){throw console.error("AudioService 초기화 실패:",e),this.isInitialized=!1,e}}async loadAudioFile(e){console.log(`오디오 파일 로드 시작: ${e}`);try{if(this.audioContext.state==="suspended"||this.audioContext.state==="closed"){console.log(`AudioContext가 ${this.audioContext.state} 상태입니다. 재개 시도...`);try{await this.audioContext.resume(),console.log("AudioContext 재개 성공, 상태:",this.audioContext.state)}catch(i){console.error("AudioContext 재개 실패:",i),console.log("AudioContext 재생성 시도 중...");try{const d=window.AudioContext||window.webkitAudioContext;this.audioContext=new d,this.masterGainNode=this.audioContext.createGain(),this.masterGainNode.gain.value=1,this.masterGainNode.connect(this.audioContext.destination),console.log("AudioContext 재생성 성공, 상태:",this.audioContext.state)}catch(d){throw console.error("AudioContext 재생성 실패:",d),new Error("오디오 컨텍스트 초기화에 실패했습니다")}}}console.log("URL로 파일 다운로드 시작...");let t;try{if(t=await fetch(e),!t.ok)throw new Error(`파일 다운로드 실패: ${t.status} ${t.statusText}`)}catch(i){throw console.error("파일 다운로드 중 오류:",i),new Error(`오디오 파일을 다운로드할 수 없습니다: ${i instanceof Error?i.message:String(i)}`)}console.log("파일 다운로드 완료, ArrayBuffer로 변환...");const r=await t.arrayBuffer();console.log(`ArrayBuffer 크기: ${r.byteLength} 바이트, 디코딩 시작...`);let a;try{a=await this.audioContext.decodeAudioData(r)}catch(i){throw console.error("오디오 디코딩 오류:",i),new Error(`오디오 파일을 디코딩할 수 없습니다: ${i instanceof Error?i.message:String(i)}`)}return console.log(`오디오 디코딩 완료 - 길이: ${a.duration.toFixed(2)}초, 채널: ${a.numberOfChannels}, 샘플레이트: ${a.sampleRate}Hz`),console.log("디코딩된 오디오 샘플:",{channelCount:a.numberOfChannels,length:a.length,duration:a.duration,sampleRate:a.sampleRate,channelDataInfo:Array.from({length:a.numberOfChannels},(i,d)=>{const m=a.getChannelData(d),y=m.reduce((p,x)=>p+(x!==0?1:0),0);return{channel:d,nonZeroSamples:y,totalSamples:m.length,nonZeroPercentage:(y/m.length*100).toFixed(2)}})}),a}catch(t){throw console.error("오디오 파일 로드 중 오류 발생:",t),t}}async decodeAudioData(e){console.log(`오디오 데이터 디코딩 시작, 크기: ${e.byteLength} 바이트`);try{this.audioContext.state==="suspended"&&(console.log("AudioContext가 일시 중단 상태입니다. resume 시도..."),await this.audioContext.resume());const t=await this.audioContext.decodeAudioData(e);console.log(`오디오 디코딩 완료 - 길이: ${t.duration.toFixed(2)}초, 채널: ${t.numberOfChannels}`);const r=new CustomEvent("audio-duration-updated",{detail:{duration:t.duration}});return window.dispatchEvent(r),t}catch(t){throw console.error("오디오 데이터 디코딩 중 오류 발생:",t),t}}generateWaveformData(e,t=1e3){const r=e.getChannelData(0),a=Math.floor(r.length/t),i=[];for(let d=0;d<t;d++){const m=d*a;let y=0;for(let p=0;p<a;p++)y+=Math.abs(r[m+p]||0);i.push(y/a)}return i}setupTrack(e){if(console.log(`트랙 설정 시작: ${e.id}, 이름: ${e.name}`),this.trackNodes.has(e.id))return console.log(`기존 트랙 업데이트: ${e.id}`),e.audioBuffer&&this.setTrackAudioBuffer(e.id,e.audioBuffer),e.id;const t=this.audioContext.createGain();t.gain.value=e.volume||1;const r=this.audioContext.createStereoPanner();r.pan.value=e.pan||0;const a=this.audioContext.createAnalyser();if(a.fftSize=2048,t.connect(r),r.connect(a),a.connect(this.masterGainNode),this.trackNodes.set(e.id,{sourceNode:void 0,gainNode:t,panNode:r,analyzerNode:a,effectNodes:[],buffer:e.audioBuffer}),console.log(`트랙 노드 생성 완료: ${e.id}`),e.audioBuffer){console.log(`트랙에 오디오 버퍼 설정 진행: ${e.id}, 길이: ${e.audioBuffer.duration.toFixed(2)}초`);const i=this.audioContext.createBufferSource();i.buffer=e.audioBuffer;const d=this.trackNodes.get(e.id);d&&(d.sourceNode=i,i.connect(d.gainNode))}else console.warn(`트랙에 오디오 버퍼가 없습니다: ${e.id}`);return e.id}setTrackAudioBuffer(e,t){const r=this.trackNodes.get(e);if(!r){const i={id:e,name:`Track ${e.substring(0,4)}`,volume:1,pan:0,muted:!1,solo:!1,gain:1,effects:[],startTime:0,duration:t?t.duration:0,markers:[],isSelected:!1};this.setupTrack(i),this.setTrackAudioBuffer(e,t);return}if(r.sourceNode){try{r.sourceNode.stop()}catch{}r.sourceNode.disconnect()}const a=this.audioContext.createBufferSource();a.buffer=t,a.connect(r.gainNode),r.sourceNode=a,r.buffer=t,console.log(`오디오 버퍼 설정 완료 - 트랙: ${e}, 길이: ${t.duration.toFixed(2)}초`)}setTrackVolume(e,t){const r=this.trackNodes.get(e);r&&(r.gainNode.gain.value=Math.max(0,Math.min(1,t)))}setTrackPan(e,t){const r=this.trackNodes.get(e);r&&(r.panNode.pan.value=Math.max(-1,Math.min(1,t)))}setMasterVolume(e){this.masterGainNode.gain.value=Math.max(0,Math.min(1,e))}applyEffect(e,t){const r=this.trackNodes.get(e);if(!r)return;let a=null;switch(t.type){case w.GAIN:a=this.createGainEffect(t);break;case w.EQ:a=this.createEqEffect(t);break;case w.COMPRESSOR:a=this.createCompressorEffect(t);break;case w.REVERB:a=this.createReverbEffect(t);break;case w.DELAY:a=this.createDelayEffect(t);break}if(a){if(r.effectNodes.length===0)r.gainNode.disconnect(),r.gainNode.connect(a),a.connect(r.panNode);else{const i=r.effectNodes[r.effectNodes.length-1];i.disconnect(),i.connect(a),a.connect(r.panNode)}r.effectNodes.push(a)}}createGainEffect(e){const t=this.audioContext.createGain(),r=e.parameters.find(a=>a.id==="gain");return r&&(t.gain.value=r.value),t}createEqEffect(e){const t=this.audioContext.createBiquadFilter(),r=e.parameters.find(m=>m.id==="type"),a=e.parameters.find(m=>m.id==="frequency"),i=e.parameters.find(m=>m.id==="gain"),d=e.parameters.find(m=>m.id==="q");if(r){const m=r.value.toString();switch(m){case"lowpass":case"highpass":case"bandpass":case"lowshelf":case"highshelf":case"peaking":case"notch":case"allpass":t.type=m;break;default:console.warn(`지원되지 않는 필터 타입: ${m}, 기본값 'lowpass'로 설정`),t.type="lowpass"}}return a&&(t.frequency.value=a.value),i&&(t.gain.value=i.value),d&&(t.Q.value=d.value),t}createCompressorEffect(e){const t=this.audioContext.createDynamicsCompressor(),r=e.parameters.find(y=>y.id==="threshold"),a=e.parameters.find(y=>y.id==="ratio"),i=e.parameters.find(y=>y.id==="attack"),d=e.parameters.find(y=>y.id==="release"),m=e.parameters.find(y=>y.id==="knee");return r&&(t.threshold.value=r.value),a&&(t.ratio.value=a.value),i&&(t.attack.value=i.value),d&&(t.release.value=d.value),m&&(t.knee.value=m.value),t}createReverbEffect(e){return this.audioContext.createConvolver()}createDelayEffect(e){const t=this.audioContext.createDelay(),r=e.parameters.find(a=>a.id==="time");return e.parameters.find(a=>a.id==="feedback"),r&&(t.delayTime.value=r.value),t}setupEffects(){console.log("이펙트 설정 시작");try{const e=this.audioContext.createBiquadFilter();e.type="peaking",e.frequency.value=1e3,e.gain.value=0,e.Q.value=1,this.effectNodes.set("equalizer",e),console.log("이퀄라이저 생성 완료");const t=this.audioContext.createDynamicsCompressor();t.threshold.value=-24,t.knee.value=30,t.ratio.value=12,t.attack.value=.003,t.release.value=.25,this.effectNodes.set("compressor",t),console.log("컴프레서 생성 완료"),console.log(`이펙트 설정 완료: ${this.effectNodes.size}개 노드 생성됨`)}catch(e){console.error("이펙트 설정 중 오류:",e)}}getEffectNode(e){return this.effectNodes.get(e)}setEffectParameter(e,t,r){try{const a=this.effectNodes.get(e);if(!a){console.error(`이펙트를 찾을 수 없음: ${e}`);return}e==="equalizer"&&a instanceof BiquadFilterNode?t==="gain"?(a.gain.value=r,console.log(`이퀄라이저 게인 설정: ${r}dB`)):t==="frequency"?(a.frequency.value=r,console.log(`이퀄라이저 주파수 설정: ${r}Hz`)):t==="Q"&&(a.Q.value=r,console.log(`이퀄라이저 Q 값 설정: ${r}`)):e==="compressor"&&a instanceof DynamicsCompressorNode&&(t==="threshold"?(a.threshold.value=r,console.log(`컴프레서 쓰레숄드 설정: ${r}dB`)):t==="ratio"&&(a.ratio.value=r,console.log(`컴프레서 비율 설정: ${r}:1`)))}catch(a){console.error(`이펙트 파라미터 설정 중 오류: ${e}.${t} = ${r}`,a)}}playTrack(e,t=0,r){console.log(`트랙 재생 요청: ${e}, 시작 시간: ${t}초${r?`, 길이: ${r}초`:""}`);const a=this.trackNodes.get(e);if(!a){console.error(`트랙 노드를 찾을 수 없음: ${e}`);return}const i=a.buffer;if(!i){console.error(`트랙의 오디오 버퍼가 없음: ${e}`);return}console.log(`버퍼 확인 - 길이: ${i.duration.toFixed(2)}초, 채널: ${i.numberOfChannels}, 샘플레이트: ${i.sampleRate}Hz`),t>=i.duration&&(console.warn(`시작 시간(${t}초)이 버퍼 길이(${i.duration.toFixed(2)}초)보다 큽니다. 시작 지점을 0으로 재설정합니다.`),t=0),r===void 0&&(r=i.duration-t,console.log(`명시적 길이가 지정되지 않음, 버퍼 전체 사용: ${r.toFixed(2)}초`));const d=i.duration-t;if(r>d&&(console.warn(`요청된 길이(${r.toFixed(2)}초)가 남은 버퍼 길이(${d.toFixed(2)}초)보다 큽니다. 길이를 조정합니다.`),r=d),a.sourceNode){try{a.sourceNode.stop()}catch{}a.sourceNode.disconnect()}try{const m=this.audioContext.createBufferSource();m.buffer=i,m.connect(a.gainNode),a.sourceNode=m,m.onended=y=>{console.log(`소스 노드 재생 완료: ${y.type}`),console.log("onended 이벤트 발생:",y),this.isPlaying=!1,this.isPaused=!1,this.pauseTime=0},this.audioContext.state==="suspended"?(console.log("AudioContext suspended 상태, 재개 시도..."),this.audioContext.resume().then(()=>{console.log("AudioContext 재개 성공, 재생 시작"),this.startSourceNode(m,t,r)}).catch(y=>{console.error("AudioContext 재개 실패:",y)})):this.startSourceNode(m,t,r)}catch(m){console.error("소스 노드 생성 또는 연결 중 오류:",m)}}startSourceNode(e,t=0,r){try{if(this.audioContext.state==="suspended"){console.log("startSourceNode: AudioContext가 suspended 상태입니다. 재개 시도..."),this.audioContext.resume().then(()=>{this.startSourceNodeInternal(e,t,r)}).catch(a=>{console.error("AudioContext 재개 실패:",a)});return}this.startSourceNodeInternal(e,t,r)}catch(a){console.error("소스 노드 시작 오류:",a)}}startSourceNodeInternal(e,t=0,r){try{if(!e.buffer){console.error("소스 노드에 AudioBuffer가 없습니다.");return}t>=e.buffer.duration&&(console.warn(`시작 시간(${t}초)이 버퍼 길이(${e.buffer.duration.toFixed(2)}초)보다 큽니다.`),t=0),r===void 0&&(r=e.buffer.duration-t,console.log(`명시적 길이가 지정되지 않음, 버퍼 전체 사용: ${r.toFixed(2)}초`));const a=e.buffer.duration-t;r>a&&(console.warn(`요청된 길이(${r.toFixed(2)}초)가 남은 버퍼 길이(${a.toFixed(2)}초)보다 큽니다. 길이를 조정합니다.`),r=a),console.log(`소스 노드 시작: 오프셋=${t}초, 길이=${r}초`),e.start(0,t,r),console.log(`트랙 재생 시작: 시작 시간: ${t}초, 길이: ${r}초`);const i=new CustomEvent("audio-duration-updated",{detail:{duration:e.buffer.duration,currentTime:t}});window.dispatchEvent(i),this.isPlaying=!0,this.isPaused=!1,this.startTime=this.audioContext.currentTime,this.pauseTime=t}catch(a){console.error("소스 노드 내부 시작 오류:",a)}}playAllTracks(e=0){if(console.log(`모든 트랙 재생 요청, 시작 시간: ${e}초, 트랙 수: ${this.trackNodes.size}`),this.trackNodes.size===0){console.warn("재생할 트랙이 없습니다. 먼저 오디오 파일을 로드하세요.");return}let t=!1;if(this.trackNodes.forEach(r=>{r.buffer&&(t=!0,console.log(`유효한 버퍼를 가진 트랙 확인: 채널 수: ${r.buffer.numberOfChannels}, 길이: ${r.buffer.duration.toFixed(2)}초`))}),!t){console.error("재생할 유효한 오디오 버퍼가 없습니다.");return}this.audioContext.state==="suspended"?(console.log("AudioContext suspended 상태, 재개 시도..."),console.warn("오디오 재생을 위해 사용자 상호작용이 필요할 수 있습니다. 화면을 클릭하세요."),this.audioContext.resume().then(()=>{console.log("AudioContext 재개 성공, 재생 시작"),this.playAllTracksInternal(e)}).catch(r=>{console.error("AudioContext 재개 실패:",r)})):this.playAllTracksInternal(e)}playAllTracksInternal(e=0){if(console.log(`모든 트랙 재생 시작, 트랙 수: ${this.trackNodes.size}, 시작 시간: ${e}초`),this.isPlaying&&(console.log("이미 재생 중이므로 모든 트랙 정지"),this.stopAllTracks()),this.trackNodes.size===0){console.warn("재생할 트랙이 없습니다.");return}this.startTime=this.audioContext.currentTime,this.pauseTime=e,this.isPlaying=!0,this.isPaused=!1,console.log(`재생 시작 시간 설정: ${this.startTime}, 시작 오프셋: ${e}초`);let t=0;this.trackNodes.forEach((r,a)=>{try{this.playTrack(a,e),t++}catch(i){console.error(`트랙 재생 중 오류 (${a}):`,i)}}),console.log(`${t}개 트랙 재생 시작됨`)}pauseTrack(e){const t=this.trackNodes.get(e);if(!(!t||!t.sourceNode))try{t.sourceNode.stop(),t.sourceNode.disconnect(),t.sourceNode=void 0,console.log(`트랙 일시 정지: ${e}`)}catch(r){console.warn(`트랙 일시 정지 중 오류 (${e}):`,r)}}pauseAllTracks(){this.pauseTime=this.getCurrentTime(),console.log(`일시 정지 시점: ${this.pauseTime.toFixed(2)}초`),this.trackNodes.forEach((e,t)=>{this.pauseTrack(t)}),this.isPlaying=!1,this.isPaused=!0,console.log("재생 일시 정지 완료")}stopTrack(e){const t=this.trackNodes.get(e);if(!(!t||!t.sourceNode)){try{t.sourceNode.stop()}catch{console.warn("소스 노드가 이미 정지되었습니다.")}this.pauseTime=0,this.isPlaying=!1}}stopAllTracks(){if(!this.isPlaying&&!this.isPaused){console.log("이미 정지된 상태입니다.");return}console.log("모든 트랙 재생 중지");let e=0;this.trackNodes.forEach((t,r)=>{if(t.sourceNode)try{t.sourceNode.stop(),t.sourceNode.disconnect(),t.sourceNode=void 0,e++}catch(a){console.warn(`트랙 정지 중 오류 (${r}):`,a)}}),console.log(`${e}개 트랙 정지 완료`),this.isPlaying=!1,this.isPaused=!1,this.pauseTime=0}getCurrentTime(){if(this.isPlaying){const e=this.audioContext.currentTime-this.startTime,t=this.pauseTime+e;return Math.floor(e*10)%30===0&&console.log(`현재 시간 계산: ${t.toFixed(2)}초 (경과: ${e.toFixed(2)}초, 오프셋: ${this.pauseTime.toFixed(2)}초)`),t}else return this.pauseTime}isPlayingTracks(){return this.isPlaying}getIsPlaying(){return this.isPlaying}pausePlayback(){if(!this.isPlaying){console.log("재생 중이 아니므로 일시 정지할 수 없습니다.");return}this.pauseTime=this.getCurrentTime(),console.log(`일시 정지 시점: ${this.pauseTime.toFixed(2)}초`),this.trackNodes.forEach((e,t)=>{e.sourceNode&&this.pauseTrack(t)}),this.isPlaying=!1,this.isPaused=!0,console.log("재생 일시 정지 완료")}resumePlayback(){if(!this.isPaused){console.log("일시 정지 상태가 아니므로 재개할 수 없습니다.");return}console.log(`일시 정지된 지점(${this.pauseTime.toFixed(2)}초)부터 재생 재개`),this.playAllTracks(this.pauseTime),this.isPaused=!1}releaseTrack(e){const t=this.trackNodes.get(e);if(t){if(t.sourceNode){try{t.sourceNode.stop()}catch{}t.sourceNode.disconnect()}t.effectNodes.forEach(r=>{r.disconnect()}),t.gainNode.disconnect(),t.panNode.disconnect(),t.analyzerNode.disconnect(),this.trackNodes.delete(e)}}releaseAllTracks(){this.trackNodes.forEach((e,t)=>{this.releaseTrack(t)})}dispose(){this.releaseAllTracks(),this.masterGainNode.disconnect(),this.audioContext.state!=="closed"&&this.audioContext.close(),this.isInitialized=!1}getTrackPeakData(e){const t=this.trackNodes.get(e);if(!t)return null;const r=t.analyzerNode,a=new Uint8Array(r.frequencyBinCount);return r.getByteFrequencyData(a),a}async exportAudio(e,t=0,r,a="wav"){const i=this.trackNodes.get(e);if(!i||!i.sourceNode||!i.sourceNode.buffer)throw new Error("유효한 오디오 트랙이 없습니다.");const d=i.sourceNode.buffer,m=d.numberOfChannels,y=d.sampleRate,p=Math.floor(t*y),A=Math.min(Math.floor((t+r)*y),d.length)-p,N=new OfflineAudioContext(m,A,y),V=N.createBufferSource();V.buffer=d,V.connect(N.destination),V.start(0,t);const I=await N.startRendering();return this.encodeWAV(I)}encodeWAV(e){const t=e.numberOfChannels,r=e.length*t*2,a=e.sampleRate,i=new ArrayBuffer(44+r),d=new DataView(i);this.writeString(d,0,"RIFF"),d.setUint32(4,36+r,!0),this.writeString(d,8,"WAVE"),this.writeString(d,12,"fmt "),d.setUint32(16,16,!0),d.setUint16(20,1,!0),d.setUint16(22,t,!0),d.setUint32(24,a,!0),d.setUint32(28,a*t*2,!0),d.setUint16(32,t*2,!0),d.setUint16(34,16,!0),this.writeString(d,36,"data"),d.setUint32(40,r,!0);const m=[];let y=44;for(let p=0;p<t;p++)m.push(e.getChannelData(p));for(let p=0;p<e.length;p++)for(let x=0;x<t;x++){const A=Math.max(-1,Math.min(1,m[x][p]));d.setInt16(y,A<0?A*32768:A*32767,!0),y+=2}return new Blob([d],{type:"audio/wav"})}writeString(e,t,r){for(let a=0;a<r.length;a++)e.setUint8(t+a,r.charCodeAt(a))}}const Fe={tracks:[],masterVolume:1,currentTime:0,isPlaying:!1,isPaused:!1,selectedTrackId:null,selectedMarker:null,zoom:1,loop:{enabled:!1,start:0,end:0},isRecording:!1,sampleRate:44100,duration:0},lt=(n,e)=>{switch(e.type){case"ADD_TRACK":return{...n,tracks:[...n.tracks,e.payload],selectedTrackId:e.payload.id,duration:Math.max(n.duration,e.payload.duration||0)};case"REMOVE_TRACK":return{...n,tracks:n.tracks.filter(t=>t.id!==e.payload),selectedTrackId:n.selectedTrackId===e.payload?null:n.selectedTrackId};case"UPDATE_TRACK":return{...n,tracks:n.tracks.map(t=>t.id===e.payload.id?{...t,...e.payload.updates}:t),duration:e.payload.updates.duration!==void 0?Math.max(...n.tracks.filter(t=>t.id!==e.payload.id).map(t=>t.duration||0),e.payload.updates.duration):n.duration};case"SET_TRACK_VOLUME":return{...n,tracks:n.tracks.map(t=>t.id===e.payload.id?{...t,volume:e.payload.volume}:t)};case"TOGGLE_TRACK_MUTE":return{...n,tracks:n.tracks.map(t=>t.id===e.payload?{...t,muted:!t.muted}:t)};case"TOGGLE_TRACK_SOLO":return{...n,tracks:n.tracks.map(t=>t.id===e.payload?{...t,solo:!t.solo}:t)};case"SELECT_TRACK":return{...n,selectedTrackId:e.payload,tracks:n.tracks.map(t=>({...t,isSelected:t.id===e.payload}))};case"SET_MASTER_VOLUME":return{...n,masterVolume:e.payload};case"SET_CURRENT_TIME":return{...n,currentTime:e.payload};case"PLAY":return{...n,isPlaying:!0,isPaused:!1};case"STOP":return{...n,isPlaying:!1,isPaused:!1};case"PAUSE":return{...n,isPlaying:!1,isPaused:!0};case"SET_LOOP":return{...n,loop:{enabled:e.payload.enabled,start:e.payload.start??n.loop.start,end:e.payload.end??n.loop.end},duration:(e.payload.end??0)>n.duration?e.payload.end??n.duration:n.duration};case"SET_DURATION":return{...n,duration:e.payload};case"ADD_EFFECT":return{...n,tracks:n.tracks.map(t=>t.id===e.payload.trackId?{...t,effects:[...t.effects,e.payload.effect]}:t)};case"REMOVE_EFFECT":return{...n,tracks:n.tracks.map(t=>t.id===e.payload.trackId?{...t,effects:t.effects.filter(r=>r.id!==e.payload.effectId)}:t)};case"UPDATE_EFFECT":return{...n,tracks:n.tracks.map(t=>t.id===e.payload.trackId?{...t,effects:t.effects.map(r=>r.id===e.payload.effectId?{...r,...e.payload.updates}:r)}:t)};case"ADD_MARKER":return{...n,tracks:n.tracks.map(t=>t.id===e.payload.trackId?{...t,markers:[...t.markers,e.payload.marker]}:t)};case"REMOVE_MARKER":return{...n,tracks:n.tracks.map(t=>t.id===e.payload.trackId?{...t,markers:t.markers.filter(r=>r.id!==e.payload.markerId)}:t)};case"UPDATE_MARKER":return{...n,tracks:n.tracks.map(t=>t.id===e.payload.trackId?{...t,markers:t.markers.map(r=>r.id===e.payload.markerId?{...r,...e.payload.updates}:r)}:t)};default:return n}},De=v.createContext({state:Fe,dispatch:()=>null,addTrack:async()=>"",removeTrack:()=>{},updateTrack:()=>{},setTrackVolume:()=>{},toggleTrackMute:()=>{},toggleTrackSolo:()=>{},setMasterVolume:()=>{},addEffect:()=>{},removeEffect:()=>{},updateEffect:()=>{},addMarker:()=>{},removeMarker:()=>{},updateMarker:()=>{},setLoop:()=>{},setCurrentTime:()=>{},play:()=>{},pause:()=>{},stop:()=>{},setSelectedTrack:()=>{},loadAudioFile:async()=>"",exportAudio:async()=>new Blob}),Ie=({children:n})=>{const[e,t]=v.useReducer(lt,Fe),r=v.useRef(null),a=v.useRef(null);v.useEffect(()=>{console.log("AudioEditorContext: AudioService 초기화 시작...");try{r.current&&(console.log("기존 AudioService 인스턴스 정리..."),a.current&&(clearInterval(a.current),a.current=null)),r.current=new Ve,r.current.initialize();const u=()=>{r.current&&r.current.audioContext.state==="suspended"&&(console.log("사용자 상호작용 감지, AudioContext 재개 시도..."),r.current.audioContext.resume().then(()=>{console.log("AudioContext 재개 성공")}).catch(h=>{console.error("AudioContext 재개 실패:",h)}))},f=["click","touchstart","keydown"];return f.forEach(h=>{document.addEventListener(h,u,{once:!0})}),console.log("AudioService 초기화 완료"),()=>{if(console.log("AudioEditorContext 언마운트: 리소스 정리..."),f.forEach(h=>{document.removeEventListener(h,u)}),a.current&&(clearInterval(a.current),a.current=null),r.current){try{r.current.getIsPlaying()&&r.current.stopAllTracks(),r.current.audioContext.close().then(()=>{console.log("AudioContext 닫기 성공")}).catch(h=>{console.error("AudioContext 닫기 실패:",h)})}catch(h){console.error("AudioService 정리 중 오류:",h)}r.current=null}}}catch(u){console.error("AudioService 초기화 중 오류 발생:",u)}},[]);const i=v.useCallback(()=>r.current,[]),d=v.useCallback(async u=>{const f=i();if(!f)return"";try{const h=u.id||Oe();return console.log(`트랙 추가: ${h}, 이름: ${u.name}`),f.setupTrack(u),t({type:"ADD_TRACK",payload:u}),h}catch(h){return console.error("트랙 추가 중 오류:",h),""}},[i]),m=v.useCallback(u=>{const f=i();f&&(f.releaseTrack(u),t({type:"REMOVE_TRACK",payload:u}))},[i]),y=v.useCallback((u,f)=>{const h=i();h&&(f.volume!==void 0&&h.setTrackVolume(u,f.volume),f.pan!==void 0&&h.setTrackPan(u,f.pan),f.audioBuffer&&h.setTrackAudioBuffer(u,f.audioBuffer),t({type:"UPDATE_TRACK",payload:{id:u,updates:f}}))},[i]),p=v.useCallback((u,f)=>{const h=i();h&&(h.setTrackVolume(u,f),t({type:"SET_TRACK_VOLUME",payload:{id:u,volume:f}}))},[i]),x=v.useCallback(u=>{const f=e.tracks.find(_=>_.id===u);if(!f)return;const h=i();h&&(h.setTrackVolume(u,f.muted?f.volume:0),t({type:"TOGGLE_TRACK_MUTE",payload:u}))},[e.tracks,i]),A=v.useCallback(u=>{const f=i();f&&(t({type:"TOGGLE_TRACK_SOLO",payload:u}),setTimeout(()=>{e.tracks.forEach(h=>{const $=e.tracks.filter(H=>H.solo).length===0?!h.muted:h.solo;f.setTrackVolume(h.id,$?h.volume:0)})},0))},[e.tracks,i]),N=v.useCallback(u=>{const f=i();f&&(f.setMasterVolume(u),t({type:"SET_MASTER_VOLUME",payload:u}))},[i]),V=v.useCallback((u,f)=>{const h=i();h&&(h.applyEffect(u,f),t({type:"ADD_EFFECT",payload:{trackId:u,effect:f}}))},[i]),I=v.useCallback((u,f)=>{t({type:"REMOVE_EFFECT",payload:{trackId:u,effectId:f}})},[]),R=v.useCallback((u,f,h)=>{t({type:"UPDATE_EFFECT",payload:{trackId:u,effectId:f,updates:h}})},[]),g=v.useCallback((u,f)=>{t({type:"ADD_MARKER",payload:{trackId:u,marker:f}})},[]),b=v.useCallback((u,f)=>{t({type:"REMOVE_MARKER",payload:{trackId:u,markerId:f}})},[]),T=v.useCallback((u,f,h)=>{t({type:"UPDATE_MARKER",payload:{trackId:u,markerId:f,updates:h}})},[]),L=v.useCallback(async(u,f)=>{const h=i();if(!h)return"";try{console.log(`파일 로드 시작: ${u}, 이름: ${f}`);let _;if(u.match(/^([A-Za-z]:\\|\/)/))if(console.log("로컬 파일 경로가 감지되었습니다."),typeof window<"u"&&window.electron){console.log("Electron 환경 감지됨, 로컬 파일 로드 중...");try{const G=(await window.electron.fs.readFile(u)).buffer;console.log(`파일 읽기 완료, 크기: ${G.byteLength} 바이트, 디코딩 시작...`),_=await h.decodeAudioData(G)}catch(M){throw console.error("Electron 파일 로드 오류:",M),new Error(`로컬 파일 접근 오류: ${M instanceof Error?M.message:String(M)}`)}}else{console.log("브라우저 환경에서 로컬 파일 접근 시도. 파일 선택기 표시...");const M=document.createElement("input");M.type="file",M.accept="audio/*";const ae=new Promise((ue,fe)=>{M.onchange=Ce=>{const Q=Ce.target.files;Q&&Q.length>0?ue(Q[0]):fe(new Error("파일을 선택하지 않았습니다."))},setTimeout(()=>{(!M.files||M.files.length===0)&&fe(new Error("파일 선택 시간이 초과되었습니다."))},3e4)});M.click(),console.log("파일 선택 대기 중...");const G=await ae;console.log(`파일 선택됨: ${G.name}, 크기: ${G.size} 바이트`),f||(f=G.name);const se=await G.arrayBuffer();console.log(`파일 읽기 완료, 크기: ${se.byteLength} 바이트, 디코딩 시작...`),_=await h.decodeAudioData(se)}else console.log("URL에서 오디오 파일 로드 중..."),_=await h.loadAudioFile(u);console.log(`오디오 버퍼 생성 완료 - 길이: ${_.duration.toFixed(2)}초, 채널: ${_.numberOfChannels}`);const $=Oe();console.log(`새 트랙 생성: ${$}`),console.log("파형 데이터 생성 중...");const H=h.generateWaveformData(_,2e3),ne={id:$,name:f||"New Track",audioBuffer:_,waveformData:H,volume:1,pan:0,muted:!1,solo:!1,gain:1,startTime:0,duration:_.duration,effects:[],markers:[],isSelected:!1};return console.log("트랙 설정 중..."),h.setupTrack(ne),console.log("상태 업데이트 중..."),t({type:"ADD_TRACK",payload:ne}),(e.loop.end===0||e.loop.end<_.duration)&&t({type:"SET_LOOP",payload:{enabled:e.loop.enabled,start:e.loop.start,end:_.duration}}),console.log(`트랙 로드 완료: ${$}, 이름: ${f}, 길이: ${_.duration.toFixed(2)}초`),$}catch(_){return console.error("오디오 파일 로드 중 오류 발생:",_),""}},[i,t,e.loop]),Z=v.useCallback(()=>{const u=i();if(!u||e.isPlaying){console.error("AudioService가 초기화되지 않았습니다.");return}if(console.log("재생 시작 시도...",e.tracks.length,"개의 트랙 존재"),e.isPaused){console.log("일시정지 상태에서 재개합니다."),u.resumePlayback(),t({type:"PLAY"});return}console.log(`${e.currentTime}초 지점부터 재생합니다.`),u.audioContext.state==="suspended"?(console.log("AudioContext가 suspended 상태입니다. resume 시도..."),u.audioContext.resume().then(()=>{console.log("AudioContext resumed"),q()}).catch(f=>{console.error("AudioContext resume 실패:",f)})):q()},[e.isPaused,e.currentTime,e.tracks.length,i,t]),q=v.useCallback(()=>{const u=i();if(!u){console.error("startPlayback: AudioService가 초기화되지 않았습니다.");return}console.log("재생 시작 전 상태:",{트랙수:e.tracks.length,현재시간:e.currentTime,재생중:e.isPlaying,일시정지:e.isPaused}),t({type:"PLAY"}),u.playAllTracks(e.currentTime),a.current&&clearInterval(a.current),a.current=window.setInterval(()=>{const f=i();if(f&&f.getIsPlaying())try{const h=f.getCurrentTime();Math.abs(h-e.currentTime)>.1&&console.log(`시간 업데이트: ${e.currentTime.toFixed(2)}초 -> ${h.toFixed(2)}초`),h%1<.05&&console.log(`재생 중: ${h.toFixed(2)}초, 전체 길이: ${e.duration.toFixed(2)}초`),t({type:"SET_CURRENT_TIME",payload:h}),e.loop.enabled&&h>=e.loop.end&&(f.playAllTracks(e.loop.start),t({type:"SET_CURRENT_TIME",payload:e.loop.start})),h>=e.duration-.1&&e.duration>0&&(console.log(`재생 종료 지점 도달: ${h.toFixed(2)}초 >= ${(e.duration-.1).toFixed(2)}초`),a.current&&(clearInterval(a.current),a.current=null),f.stopAllTracks(),t({type:"STOP"}))}catch(h){console.error("시간 업데이트 중 오류:",h)}},30)},[e.currentTime,e.loop,e.duration,e.tracks.length,e.isPlaying,e.isPaused,i,t]),W=v.useCallback(()=>{const u=i();!u||!e.isPlaying||(u.pausePlayback(),a.current&&(clearInterval(a.current),a.current=null),t({type:"PAUSE"}))},[e.isPlaying,i]),xe=v.useCallback(()=>{const u=i();u&&(u.stopAllTracks(),a.current&&(clearInterval(a.current),a.current=null),t({type:"SET_CURRENT_TIME",payload:0}),t({type:"STOP"}))},[i]),ye=v.useCallback(u=>{t({type:"SELECT_TRACK",payload:u})},[]),de=v.useCallback((u,f,h)=>{t({type:"SET_LOOP",payload:{enabled:u,start:f,end:h}})},[]),ve=v.useCallback(u=>{t({type:"SET_CURRENT_TIME",payload:u})},[]),be=v.useCallback(async(u,f,h,_)=>{const $=i();if(!$)throw new Error("오디오 서비스가 초기화되지 않았습니다.");try{return await $.exportAudio(u,f,h,_)}catch(H){throw console.error("오디오 내보내기 중 오류:",H),H}},[i]);return s.jsx(De.Provider,{value:{state:e,dispatch:t,addTrack:d,removeTrack:m,updateTrack:y,setTrackVolume:p,toggleTrackMute:x,toggleTrackSolo:A,setMasterVolume:N,addEffect:V,removeEffect:I,updateEffect:R,addMarker:g,removeMarker:b,updateMarker:T,setLoop:de,setCurrentTime:ve,play:Z,pause:W,stop:xe,setSelectedTrack:ye,loadAudioFile:L,exportAudio:be},children:n})},X=()=>{const n=v.useContext(De);if(n===void 0)throw new Error("useAudioEditor must be used within an AudioEditorProvider");return n},Me=({track:n})=>{const e=v.useRef(null),{setSelectedTrack:t,setTrackVolume:r,toggleTrackMute:a,toggleTrackSolo:i,removeTrack:d}=X();v.useEffect(()=>{if(!e.current||!n.waveformData)return;const p=e.current,x=p.getContext("2d");if(!x)return;x.clearRect(0,0,p.width,p.height);const A=n.waveformData,N=A.length,V=p.width/N,I=p.height;x.fillStyle=n.isSelected?"#4f9df3":"#3a7abd",x.strokeStyle=n.isSelected?"#7fb5f5":"#5a8fd3",x.lineWidth=1;for(let R=0;R<N;R++){const g=R*V,b=A[R]*I,T=(I-b)/2;x.fillRect(g,T,V,b),x.strokeRect(g,T,V,b)}n.markers&&n.markers.length>0&&n.markers.forEach(R=>{const g=R.time/n.duration*p.width;x.beginPath(),x.moveTo(g,0),x.lineTo(g,p.height),x.strokeStyle=R.color,x.lineWidth=2,x.stroke(),x.fillStyle=R.color,x.font="10px Arial",x.fillText(R.name,g+2,10)})},[n]);const m=p=>{const x=parseFloat(p.target.value);r(n.id,x)},y=()=>{t(n.id)};return s.jsxs("div",{className:`audio-track ${n.isSelected?"selected":""}`,onClick:y,style:{padding:"10px",marginBottom:"10px",border:`1px solid ${n.isSelected?"#4f9df3":"#ccc"}`,borderRadius:"4px",backgroundColor:n.isSelected?"#f0f7ff":"#f9f9f9",position:"relative"},children:[s.jsxs("div",{className:"track-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[s.jsx("div",{className:"track-name",style:{fontWeight:"bold"},children:n.name}),s.jsxs("div",{className:"track-controls",style:{display:"flex",gap:"10px"},children:[s.jsx("button",{onClick:p=>{p.stopPropagation(),a(n.id)},style:{backgroundColor:n.muted?"#ff6b6b":"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"4px",padding:"4px 8px",cursor:"pointer"},children:n.muted?"음소거 해제":"음소거"}),s.jsx("button",{onClick:p=>{p.stopPropagation(),i(n.id)},style:{backgroundColor:n.solo?"#ffd43b":"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"4px",padding:"4px 8px",cursor:"pointer"},children:n.solo?"솔로 해제":"솔로"}),s.jsx("button",{onClick:p=>{p.stopPropagation(),d(n.id)},style:{backgroundColor:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"4px",padding:"4px 8px",cursor:"pointer"},children:"제거"})]})]}),s.jsx("div",{className:"track-waveform",style:{position:"relative",marginBottom:"10px"},children:s.jsx("canvas",{ref:e,width:800,height:100,style:{width:"100%",height:"100px"}})}),s.jsxs("div",{className:"track-volume",style:{display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx("span",{children:"볼륨:"}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:n.volume,onChange:m,onClick:p=>p.stopPropagation(),style:{flex:1}}),s.jsxs("span",{children:[Math.round(n.volume*100),"%"]})]}),s.jsxs("div",{className:"track-info",style:{marginTop:"10px",fontSize:"0.9em",color:"#666"},children:[s.jsxs("span",{children:["시작: ",n.startTime.toFixed(2),"초"]}),s.jsxs("span",{style:{marginLeft:"10px"},children:["길이: ",n.duration.toFixed(2),"초"]}),n.effects.length>0&&s.jsxs("span",{style:{marginLeft:"10px"},children:["효과: ",n.effects.length,"개"]})]})]})},Be=()=>{const{state:n}=X();return s.jsxs("div",{className:"track-list",style:{padding:"10px"},children:[s.jsxs("h3",{style:{marginBottom:"15px"},children:["오디오 트랙 (",n.tracks.length,")"]}),n.tracks.length===0?s.jsx("div",{className:"empty-state",style:{padding:"20px",textAlign:"center",backgroundColor:"#f8f9fa",borderRadius:"4px",color:"#6c757d"},children:"오디오 파일을 불러와 트랙을 추가해주세요."}):s.jsx("div",{className:"tracks",children:n.tracks.map(e=>s.jsx(Me,{track:e},e.id))})]})},Ue=()=>{const{state:n,addEffect:e,removeEffect:t,updateEffect:r}=X(),[a,i]=v.useState(w.GAIN),{selectedTrackId:d}=n,m=d?n.tracks.find(g=>g.id===d):null,y=()=>{if(!d)return;const g=[];switch(a){case w.GAIN:g.push({id:"gain",name:"게인",value:1,minValue:0,maxValue:2,defaultValue:1,step:.01,unit:"x"});break;case w.EQ:g.push({id:"type",name:"필터 유형",value:0,minValue:0,maxValue:7,defaultValue:0,step:1},{id:"frequency",name:"주파수",value:1e3,minValue:20,maxValue:2e4,defaultValue:1e3,step:1,unit:"Hz"},{id:"gain",name:"게인",value:0,minValue:-15,maxValue:15,defaultValue:0,step:.1,unit:"dB"},{id:"q",name:"Q 값",value:1,minValue:.1,maxValue:10,defaultValue:1,step:.1});break;case w.COMPRESSOR:g.push({id:"threshold",name:"기준치",value:-24,minValue:-60,maxValue:0,defaultValue:-24,step:1,unit:"dB"},{id:"ratio",name:"비율",value:4,minValue:1,maxValue:20,defaultValue:4,step:.5},{id:"attack",name:"어택",value:.003,minValue:0,maxValue:1,defaultValue:.003,step:.001,unit:"s"},{id:"release",name:"릴리즈",value:.25,minValue:0,maxValue:1,defaultValue:.25,step:.01,unit:"s"},{id:"knee",name:"니",value:30,minValue:0,maxValue:40,defaultValue:30,step:1,unit:"dB"});break;case w.REVERB:g.push({id:"decay",name:"감쇠",value:2,minValue:.1,maxValue:10,defaultValue:2,step:.1,unit:"s"},{id:"wet",name:"웻",value:.3,minValue:0,maxValue:1,defaultValue:.3,step:.01},{id:"dry",name:"드라이",value:.7,minValue:0,maxValue:1,defaultValue:.7,step:.01});break;case w.DELAY:g.push({id:"time",name:"시간",value:.3,minValue:0,maxValue:5,defaultValue:.3,step:.01,unit:"s"},{id:"feedback",name:"피드백",value:.5,minValue:0,maxValue:.95,defaultValue:.5,step:.01},{id:"mix",name:"믹스",value:.5,minValue:0,maxValue:1,defaultValue:.5,step:.01});break;case w.PITCH_SHIFT:g.push({id:"pitch",name:"피치",value:0,minValue:-12,maxValue:12,defaultValue:0,step:1,unit:"반음"},{id:"mix",name:"믹스",value:1,minValue:0,maxValue:1,defaultValue:1,step:.01});break}const b={id:`effect-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:p(a),type:a,enabled:!0,parameters:g};e(d,b)},p=g=>{switch(g){case w.GAIN:return"게인";case w.EQ:return"이퀄라이저";case w.COMPRESSOR:return"컴프레서";case w.REVERB:return"리버브";case w.DELAY:return"딜레이";case w.NOISE_REDUCTION:return"노이즈 제거";case w.FADE:return"페이드";case w.LIMITER:return"리미터";case w.PITCH_SHIFT:return"피치 시프트";case w.TIME_STRETCH:return"타임 스트레치";default:return"알 수 없음"}},x=(g,b,T)=>{if(!d)return;const L=n.tracks.find(W=>W.id===d);if(!L)return;const Z=L.effects.find(W=>W.id===g);if(!Z)return;const q=Z.parameters.map(W=>W.id===b?{...W,value:T}:W);r(d,g,{parameters:q})},A=g=>{if(!d)return;const b=n.tracks.find(L=>L.id===d);if(!b)return;const T=b.effects.find(L=>L.id===g);T&&r(d,g,{enabled:!T.enabled})},N=g=>{d&&t(d,g)},V=g=>["peaking","lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass"][g]||"peaking",I=(g,b)=>{if(b.id==="type"){const T=V(b.value);return s.jsxs("div",{style:{marginBottom:"10px"},children:[s.jsx("label",{style:{display:"block",marginBottom:"5px"},children:b.name}),s.jsxs("select",{value:b.value,onChange:L=>x(g.id,b.id,parseInt(L.target.value)),style:{width:"100%",padding:"5px",borderRadius:"4px",border:"1px solid #ced4da"},children:[s.jsx("option",{value:0,children:"피킹 (Peaking)"}),s.jsx("option",{value:1,children:"로우패스 (Lowpass)"}),s.jsx("option",{value:2,children:"하이패스 (Highpass)"}),s.jsx("option",{value:3,children:"밴드패스 (Bandpass)"}),s.jsx("option",{value:4,children:"로우쉘프 (Lowshelf)"}),s.jsx("option",{value:5,children:"하이쉘프 (Highshelf)"}),s.jsx("option",{value:6,children:"노치 (Notch)"}),s.jsx("option",{value:7,children:"올패스 (Allpass)"})]}),s.jsxs("div",{style:{fontSize:"0.8em",color:"#6c757d",marginTop:"3px"},children:["현재: ",T]})]},b.id)}return R(g,b)},R=(g,b)=>s.jsxs("div",{style:{marginBottom:"10px"},children:[s.jsxs("label",{style:{display:"block",marginBottom:"5px"},children:[b.name," ",b.unit?`(${b.unit})`:""]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx("input",{type:"range",min:b.minValue,max:b.maxValue,step:b.step,value:b.value,onChange:T=>x(g.id,b.id,parseFloat(T.target.value)),style:{flex:1}}),s.jsx("input",{type:"number",min:b.minValue,max:b.maxValue,step:b.step,value:b.value,onChange:T=>x(g.id,b.id,parseFloat(T.target.value)),style:{width:"70px",padding:"3px",textAlign:"right",borderRadius:"4px",border:"1px solid #ced4da"}})]})]},b.id);return s.jsxs("div",{className:"effects-panel",style:{padding:"10px"},children:[s.jsx("h3",{style:{marginBottom:"15px"},children:"효과 패널"}),m?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"add-effect-section",style:{marginBottom:"20px"},children:s.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"},children:[s.jsxs("select",{value:a,onChange:g=>i(g.target.value),style:{flex:1,padding:"8px",borderRadius:"4px",border:"1px solid #ced4da"},children:[s.jsx("option",{value:w.GAIN,children:"게인"}),s.jsx("option",{value:w.EQ,children:"이퀄라이저"}),s.jsx("option",{value:w.COMPRESSOR,children:"컴프레서"}),s.jsx("option",{value:w.REVERB,children:"리버브"}),s.jsx("option",{value:w.DELAY,children:"딜레이"}),s.jsx("option",{value:w.PITCH_SHIFT,children:"피치 시프트"})]}),s.jsx("button",{onClick:y,style:{padding:"8px 15px",backgroundColor:"#4f9df3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"효과 추가"})]})}),s.jsx("div",{className:"effects-list",children:m.effects.length===0?s.jsx("div",{style:{padding:"15px",textAlign:"center",backgroundColor:"#f8f9fa",borderRadius:"4px",color:"#6c757d"},children:"효과가 없습니다. 위 드롭다운에서 효과를 선택하고 추가해 보세요."}):m.effects.map(g=>s.jsxs("div",{className:"effect-item",style:{marginBottom:"20px",border:"1px solid #dee2e6",borderRadius:"4px",backgroundColor:g.enabled?"#ffffff":"#f8f9fa"},children:[s.jsxs("div",{className:"effect-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",borderBottom:"1px solid #dee2e6",backgroundColor:g.enabled?"#e9f5ff":"#f1f3f5"},children:[s.jsx("div",{style:{fontWeight:"bold"},children:g.name}),s.jsxs("div",{style:{display:"flex",gap:"10px"},children:[s.jsx("button",{onClick:()=>A(g.id),style:{padding:"4px 8px",backgroundColor:g.enabled?"#4f9df3":"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.9em"},children:g.enabled?"활성화됨":"비활성화됨"}),s.jsx("button",{onClick:()=>N(g.id),style:{padding:"4px 8px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.9em"},children:"제거"})]})]}),s.jsx("div",{className:"effect-body",style:{padding:"15px",opacity:g.enabled?1:.7},children:g.parameters.map(b=>g.type===w.EQ?I(g,b):R(g,b))})]},g.id))})]}):s.jsx("div",{style:{padding:"20px",textAlign:"center",backgroundColor:"#f8f9fa",borderRadius:"4px",color:"#6c757d"},children:"효과를 적용할 트랙을 먼저 선택해주세요."})]})},Le=()=>{const{state:n,play:e,pause:t,stop:r,setCurrentTime:a,setLoop:i}=X(),{isPlaying:d,currentTime:m,duration:y,loop:p}=n,x=R=>{if(isNaN(R)||R<0)return console.warn("유효하지 않은 시간 값:",R),"00:00.00";const g=Math.floor(R/60),b=Math.floor(R%60),T=Math.floor(R%1*100);return R>0&&R%5<.03&&console.log(`시간 포맷: ${R} -> ${g}:${b}.${T}`),`${g.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}.${T.toString().padStart(2,"0")}`},A=R=>{const g=parseFloat(R.target.value);a(g)},N=()=>{i(!p.enabled,p.start,p.end)},V=()=>{i(!0,m,p.end)},I=()=>{i(!0,p.start,m)};return s.jsxs("div",{className:"transport-controls",style:{padding:"15px",backgroundColor:"#f1f3f5",borderRadius:"6px",margin:"10px 0",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[s.jsxs("div",{className:"playback-controls",style:{display:"flex",justifyContent:"center",marginBottom:"15px",gap:"15px"},children:[s.jsx("button",{onClick:r,style:{backgroundColor:"#343a40",color:"white",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},title:"정지",children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:s.jsx("rect",{width:"12",height:"12",x:"2",y:"2"})})}),d?s.jsx("button",{onClick:t,style:{backgroundColor:"#495057",color:"white",border:"none",borderRadius:"50%",width:"50px",height:"50px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},title:"일시정지",children:s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 16 16",fill:"currentColor",children:[s.jsx("rect",{width:"4",height:"14",x:"3",y:"1"}),s.jsx("rect",{width:"4",height:"14",x:"9",y:"1"})]})}):s.jsx("button",{onClick:e,style:{backgroundColor:"#4f9df3",color:"white",border:"none",borderRadius:"50%",width:"50px",height:"50px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},title:"재생",children:s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 16 16",fill:"currentColor",children:s.jsx("polygon",{points:"2,1 14,8 2,15"})})})]}),s.jsxs("div",{className:"time-controls",style:{display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx("span",{style:{minWidth:"70px",fontFamily:"monospace"},children:x(m)}),s.jsx("input",{type:"range",min:"0",max:y||100,step:"0.01",value:m,onChange:A,style:{flex:1}}),s.jsx("span",{style:{minWidth:"70px",fontFamily:"monospace",textAlign:"right"},children:x(y)})]}),s.jsxs("div",{className:"loop-controls",style:{display:"flex",justifyContent:"center",marginTop:"15px",gap:"10px"},children:[s.jsx("button",{onClick:N,style:{backgroundColor:p.enabled?"#4f9df3":"#f8f9fa",color:p.enabled?"white":"#495057",border:"1px solid #dee2e6",borderRadius:"4px",padding:"5px 10px",cursor:"pointer",fontSize:"0.9em"},children:p.enabled?"루프 켜짐":"루프 꺼짐"}),s.jsxs("button",{onClick:V,disabled:!p.enabled,style:{backgroundColor:p.enabled?"#e9ecef":"#f8f9fa",color:p.enabled?"#495057":"#adb5bd",border:"1px solid #dee2e6",borderRadius:"4px",padding:"5px 10px",cursor:p.enabled?"pointer":"not-allowed",fontSize:"0.9em"},children:["시작: ",x(p.start)]}),s.jsxs("button",{onClick:I,disabled:!p.enabled,style:{backgroundColor:p.enabled?"#e9ecef":"#f8f9fa",color:p.enabled?"#495057":"#adb5bd",border:"1px solid #dee2e6",borderRadius:"4px",padding:"5px 10px",cursor:p.enabled?"pointer":"not-allowed",fontSize:"0.9em"},children:["끝: ",x(p.end)]})]})]})},$e=()=>{const{loadAudioFile:n}=X(),e=v.useRef(null),[t,r]=v.useState(!1),[a,i]=v.useState(null),d=async y=>{const p=y.target.files;if(!p||p.length===0)return;const x=p[0];if(!x.type.startsWith("audio/")){i("오디오 파일만 업로드할 수 있습니다.");return}r(!0),i(null);try{const A=new FileReader;A.onload=async N=>{if(N.target&&N.target.result){const V=N.target.result,I=new Blob([V],{type:x.type}),R=URL.createObjectURL(I);try{await n(R,x.name),r(!1),e.current&&(e.current.value="")}catch(g){console.error("오디오 파일 로드 실패:",g),i("오디오 파일을 로드하는 중 오류가 발생했습니다."),r(!1)}}},A.onerror=()=>{i("파일을 읽는 중 오류가 발생했습니다."),r(!1)},A.readAsArrayBuffer(x)}catch(A){console.error("파일 처리 중 오류:",A),i("파일 처리 중 오류가 발생했습니다."),r(!1)}},m=()=>{e.current&&e.current.click()};return s.jsxs("div",{className:"audio-file-uploader",style:{padding:"15px",border:"2px dashed #dee2e6",borderRadius:"6px",textAlign:"center",backgroundColor:"#f8f9fa"},children:[s.jsx("input",{type:"file",ref:e,onChange:d,accept:"audio/*",style:{display:"none"}}),s.jsx("button",{onClick:m,disabled:t,style:{padding:"10px 20px",backgroundColor:t?"#adb5bd":"#4f9df3",color:"white",border:"none",borderRadius:"4px",cursor:t?"not-allowed":"pointer",fontSize:"1em",display:"block",margin:"0 auto 15px"},children:t?"로딩 중...":"오디오 파일 선택"}),s.jsx("div",{style:{fontSize:"0.9em",color:"#6c757d"},children:"WAV, MP3, FLAC, AAC 등의 오디오 파일을 업로드할 수 있습니다."}),a&&s.jsx("div",{style:{marginTop:"10px",color:"#e03131",padding:"8px",backgroundColor:"#fff5f5",borderRadius:"4px"},children:a})]})},ct=()=>s.jsx(Ie,{children:s.jsxs("div",{className:"audio-editor-container",style:{fontFamily:"Arial, sans-serif",maxWidth:"1200px",margin:"0 auto",padding:"20px"},children:[s.jsxs("div",{className:"header",style:{marginBottom:"20px",borderBottom:"1px solid #dee2e6",paddingBottom:"20px"},children:[s.jsx("h1",{style:{margin:"0 0 10px 0",color:"#343a40"},children:"vCut 오디오 편집기"}),s.jsx("p",{style:{margin:"0",color:"#6c757d"},children:"오디오 트랙을 업로드하고 효과를 적용하여 편집해보세요."})]}),s.jsxs("div",{className:"main-content",style:{display:"flex",gap:"20px"},children:[s.jsxs("div",{className:"left-panel",style:{flex:"2",minWidth:"0"},children:[s.jsxs("div",{className:"upload-section",style:{marginBottom:"20px"},children:[s.jsx("h2",{style:{margin:"0 0 10px 0",fontSize:"1.3em",color:"#343a40"},children:"오디오 파일 업로드"}),s.jsx($e,{})]}),s.jsxs("div",{className:"transport-section",style:{marginBottom:"20px"},children:[s.jsx("h2",{style:{margin:"0 0 10px 0",fontSize:"1.3em",color:"#343a40"},children:"재생 컨트롤"}),s.jsx(Le,{})]}),s.jsxs("div",{className:"tracks-section",children:[s.jsx("h2",{style:{margin:"0 0 10px 0",fontSize:"1.3em",color:"#343a40"},children:"오디오 트랙"}),s.jsx(Be,{})]})]}),s.jsxs("div",{className:"right-panel",style:{flex:"1",minWidth:"300px"},children:[s.jsx("h2",{style:{margin:"0 0 10px 0",fontSize:"1.3em",color:"#343a40"},children:"오디오 효과"}),s.jsx(Ue,{})]})]}),s.jsx("div",{className:"footer",style:{marginTop:"30px",borderTop:"1px solid #dee2e6",paddingTop:"20px",textAlign:"center",color:"#6c757d",fontSize:"0.9em"},children:"vCut 오디오 편집 모듈 - 버전 0.1.0"})]})});j.AudioEditorProvider=Ie,j.AudioEffectType=w,j.AudioFileUploader=$e,j.AudioService=Ve,j.AudioTrack=Me,j.EffectsPanel=Ue,j.TestAudioEditor=ct,j.TrackList=Be,j.TransportControls=Le,j.useAudioEditor=X,Object.defineProperty(j,Symbol.toStringTag,{value:"Module"})});
